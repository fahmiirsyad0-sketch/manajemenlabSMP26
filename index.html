<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DigiLabo - Sistem Manajemen Laboratorium</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .auth-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full gradient-bg"><!-- Main Container -->
  <div class="min-h-full flex items-center justify-center p-4">
   <div class="max-w-md w-full" id="mainContainer"><!-- Real-time Clock -->
    <div class="fixed top-4 right-4 bg-white bg-opacity-20 backdrop-blur-sm rounded-lg px-4 py-2 text-white text-sm font-medium z-50">
     <div id="realTimeClock">
      --:--:--
     </div>
     <div id="realTimeDate" class="text-xs opacity-80">
      -- --- ----
     </div>
    </div><!-- Header -->
    <div class="text-center mb-8">
     <div class="flex items-center justify-center mb-6">
      <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
       <svg class="h-10 w-10 text-white" fill="currentColor" viewbox="0 0 24 24"><path d="M12 2L2 7v10c0 5.55 3.84 10 9 11 1.09-.21 2.28-.71 3.33-1.36C16.67 25.64 18.91 24.36 20 22.64 21.09 20.93 22 18.77 22 17V7l-10-5zm0 2.18L19.82 8 12 11.82 4.18 8 12 4.18zM4 9.18l7 3.5v8.14C8.94 19.9 6.34 17.2 4 14.5V9.18zm16 5.32c-2.34 2.7-4.94 5.4-7 6.32v-8.14l7-3.5v5.32z" />
       </svg>
      </div>
     </div>
     <h1 id="site-title" class="text-4xl font-bold text-white mb-3">DigiLabo</h1>
     <p id="hero-subtitle" class="text-lg text-indigo-100 max-w-sm mx-auto leading-relaxed">Solusi lengkap manajemen laboratorium SMP Negeri 26 Surabaya</p>
    </div><!-- Auth Card -->
    <div class="auth-card rounded-2xl shadow-2xl p-8"><!-- Login Form -->
     <div id="loginForm" class="auth-form">
      <h2 id="login-title" class="text-2xl font-bold text-gray-900 mb-6 text-center">Masuk ke Sistem</h2><!-- Error Message -->
      <div id="loginError" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4 text-sm">
       <div class="flex items-center">
        <svg class="w-4 h-4 mr-2" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
        </svg><span id="loginErrorText"></span>
       </div>
      </div>
      <form onsubmit="handleLogin(event)">
       <div class="mb-4"><label for="loginEmail" class="block text-sm font-medium text-gray-700 mb-2">Email</label> <input type="email" id="loginEmail" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all" placeholder="nama@email.com">
       </div>
       <div class="mb-6"><label for="loginPassword" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
        <div class="relative"><input type="password" id="loginPassword" required class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all" placeholder="Masukkan password"> <button type="button" onclick="togglePassword('loginPassword', 'loginToggle')" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors">
          <svg id="loginToggle" class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
          </svg></button>
        </div>
       </div><button type="submit" id="loginBtn" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors mb-4 disabled:opacity-50 disabled:cursor-not-allowed"> Masuk </button>
      </form>
      <div class="text-center">
       <p class="text-gray-600 mb-2">Belum punya akun?</p><button onclick="showRegisterForm()" class="text-indigo-600 hover:text-indigo-700 font-semibold transition-colors"> Daftar Akun Baru </button>
      </div>
     </div><!-- Register Form -->
     <div id="registerForm" class="auth-form hidden">
      <h2 id="register-title" class="text-2xl font-bold text-gray-900 mb-6 text-center">Daftar Akun Baru</h2><!-- Error Message -->
      <div id="registerError" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4 text-sm">
       <div class="flex items-center">
        <svg class="w-4 h-4 mr-2" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
        </svg><span id="registerErrorText"></span>
       </div>
      </div>
      <form onsubmit="handleRegister(event)">
       <div class="mb-4"><label for="registerName" class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label> <input type="text" id="registerName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all" placeholder="Masukkan nama lengkap">
       </div>
       <div class="mb-4"><label for="registerEmail" class="block text-sm font-medium text-gray-700 mb-2">Email</label> <input type="email" id="registerEmail" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all" placeholder="nama@email.com">
       </div>
       <div class="mb-4"><label for="registerPassword" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
        <div class="relative"><input type="password" id="registerPassword" required class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all" placeholder="Buat password (min. 6 karakter)"> <button type="button" onclick="togglePassword('registerPassword', 'registerToggle')" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors">
          <svg id="registerToggle" class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
          </svg></button>
        </div>
       </div>
       <div class="mb-6"><label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-2">Konfirmasi Password</label>
        <div class="relative"><input type="password" id="confirmPassword" required class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all" placeholder="Ulangi password"> <button type="button" onclick="togglePassword('confirmPassword', 'confirmToggle')" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors">
          <svg id="confirmToggle" class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
          </svg></button>
        </div>
       </div><button type="submit" id="registerBtn" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors mb-4 disabled:opacity-50 disabled:cursor-not-allowed"> Daftar Akun </button>
      </form>
      <div class="text-center">
       <p class="text-gray-600 mb-2">Sudah punya akun?</p><button onclick="showLoginForm()" class="text-indigo-600 hover:text-indigo-700 font-semibold transition-colors"> Masuk di Sini </button>
      </div>
     </div><!-- Success Message -->
     <div id="successMessage" class="auth-form hidden text-center">
      <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
       <svg class="w-10 h-10 text-green-600" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
       </svg>
      </div>
      <h2 class="text-2xl font-bold text-gray-900 mb-4">Selamat Datang!</h2>
      <p class="text-gray-600 mb-6" id="welcomeMessage">Berhasil masuk ke sistem DigiLabo!</p><button onclick="showDashboard()" class="bg-indigo-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors"> Lanjutkan ke Dashboard </button>
     </div><!-- Dashboard Preview -->
     <div id="dashboardPreview" class="auth-form hidden">
      <div class="text-center mb-6">
       <div class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
        <svg class="w-8 h-8 text-indigo-600" fill="currentColor" viewbox="0 0 20 20"><path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" />
        </svg>
       </div>
       <h2 class="text-2xl font-bold text-gray-900 mb-2">Dashboard DigiLabo</h2>
       <p class="text-gray-600" id="userWelcome">Selamat datang di sistem manajemen laboratorium!</p>
      </div>
      <div class="space-y-4 mb-6">
       <div class="bg-gray-50 p-4 rounded-lg">
        <h3 class="font-semibold text-gray-900 mb-2">ðŸ“Š Statistik Kunjungan Website Minggu Ini</h3>
        <div class="grid grid-cols-2 gap-4 text-sm">
         <div><span class="text-gray-600">Total Kunjungan:</span> <span class="font-semibold text-indigo-600 ml-1" id="totalVisits">247</span>
         </div>
         <div><span class="text-gray-600">Praktikum Terbooking:</span> <span class="font-semibold text-green-600 ml-1" id="bookedSessions">32</span>
         </div>
        </div>
       </div>
       <div class="bg-gray-50 p-4 rounded-lg">
        <h3 class="font-semibold text-gray-900 mb-2">ðŸ”¬ Fitur Utama</h3>
        <div class="space-y-2 text-sm">
         <div class="flex items-center text-gray-600"><span class="w-2 h-2 bg-indigo-400 rounded-full mr-2"></span> Booking Ruang
         </div>
         <div class="flex items-center text-gray-600"><span class="w-2 h-2 bg-orange-400 rounded-full mr-2"></span> Laporan Pengaduan
         </div>
         <div class="flex items-center text-gray-600"><span class="w-2 h-2 bg-green-400 rounded-full mr-2"></span> Data Inventaris
         </div>
         <div class="flex items-center text-gray-600"><span class="w-2 h-2 bg-purple-400 rounded-full mr-2"></span> Laporan Digital (Rekap Insiden)
         </div>
        </div>
       </div>
      </div>
      <div class="space-y-3">
       <div class="space-y-3">
        <div class="flex space-x-3"><button onclick="showSchedulePage()" class="flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-indigo-700 transition-colors"> Jadwal Praktikum </button> <button onclick="showIncidentForm()" class="flex-1 bg-orange-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-orange-700 transition-colors"> Laporan Insiden </button>
        </div><button onclick="showInventoryPage()" class="w-full bg-green-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-green-700 transition-colors"> ðŸ“¦ Data Inventaris </button>
       </div><button onclick="showLoginForm()" class="w-full bg-gray-200 text-gray-700 py-2 px-4 rounded-lg font-medium hover:bg-gray-300 transition-colors"> Keluar </button>
      </div>
     </div><!-- Schedule Page -->
     <div id="schedulePage" class="hidden"><!-- Booking Form Modal -->
      <div id="bookingFormModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
       <div class="bg-white rounded-lg p-6 w-full max-w-md">
        <div class="flex items-center justify-between mb-4">
         <h3 class="text-lg font-bold text-gray-900">Booking Praktikum</h3><button onclick="hideBookingForm()" class="text-gray-400 hover:text-gray-600">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg></button>
        </div>
        <div class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
         <div class="text-sm text-blue-800"><strong>Slot yang dipilih:</strong><br><span id="selectedSlotInfo">-</span>
         </div>
        </div>
        <form onsubmit="handleBookingSubmit(event)" class="space-y-4">
         <div><label for="bookingTeacher" class="block text-sm font-medium text-gray-700 mb-2">Nama Guru</label> <select id="bookingTeacher" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"> <option value="">Pilih Guru</option> <option value="Siti Anidah P., S.Pd (3)">Siti Anidah P., S.Pd (3)</option> <option value="Nurhayati Ningsih, S.Pd (7)">Nurhayati Ningsih, S.Pd (7)</option> <option value="Wiwin Andarie, S.Pd, M.Psi (16)">Wiwin Andarie, S.Pd, M.Psi (16)</option> <option value="Suci Alima, S.Si, M.Pd (22)">Suci Alima, S.Si, M.Pd (22)</option> <option value="Mahmud S.Pd (39)">Mahmud S.Pd (39)</option> <option value="Nurul Adi Setiyawan, S.Pd (46b)">Nurul Adi Setiyawan, S.Pd (46b)</option> <option value="Shelma Rahmadita, S.Pd (47b)">Shelma Rahmadita, S.Pd (47b)</option> </select>
         </div>
         <div><label for="bookingClass" class="block text-sm font-medium text-gray-700 mb-2">Kelas</label> <select id="bookingClass" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"> <option value="">Pilih Kelas</option> <optgroup label="Kelas VII"> <option value="VII A">VII A</option> <option value="VII B">VII B</option> <option value="VII C">VII C</option> <option value="VII D">VII D</option> <option value="VII E">VII E</option> <option value="VII F">VII F</option> <option value="VII G">VII G</option> <option value="VII H">VII H</option> <option value="VII I">VII I</option> <option value="VII J">VII J</option> </optgroup> <optgroup label="Kelas VIII"> <option value="VIII A">VIII A</option> <option value="VIII B">VIII B</option> <option value="VIII C">VIII C</option> <option value="VIII D">VIII D</option> <option value="VIII E">VIII E</option> <option value="VIII F">VIII F</option> <option value="VIII G">VIII G</option> <option value="VIII H">VIII H</option> <option value="VIII I">VIII I</option> <option value="VIII J">VIII J</option> </optgroup> <optgroup label="Kelas IX"> <option value="IX A">IX A</option> <option value="IX B">IX B</option> <option value="IX C">IX C</option> <option value="IX D">IX D</option> <option value="IX E">IX E</option> <option value="IX F">IX F</option> <option value="IX G">IX G</option> <option value="IX H">IX H</option> <option value="IX I">IX I</option> <option value="IX J">IX J</option> </optgroup> </select>
         </div>
         <div><label for="bookingSubject" class="block text-sm font-medium text-gray-700 mb-2">Materi Praktikum</label> <input type="text" id="bookingSubject" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none" placeholder="Masukkan materi praktikum yang akan diajarkan" maxlength="100">
          <div class="mt-1 text-xs text-gray-500">
           Contoh: Pengamatan sel tumbuhan dengan mikroskop, Praktikum reaksi kimia sederhana, dll.
          </div>
         </div>
         <div><label for="bookingNotes" class="block text-sm font-medium text-gray-700 mb-2">Catatan Tambahan</label> <textarea id="bookingNotes" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none resize-none" placeholder="Catatan khusus untuk praktikum ini (opsional)"></textarea>
         </div>
         <div class="flex space-x-3 pt-4"><button type="button" onclick="hideBookingForm()" class="flex-1 bg-gray-200 text-gray-700 py-2 px-4 rounded-lg font-medium hover:bg-gray-300 transition-colors"> Batal </button> <button type="submit" id="bookingSubmitBtn" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-blue-700 transition-colors disabled:opacity-50"> Booking Sekarang </button>
         </div>
        </form>
       </div>
      </div>
      <div class="mb-4">
       <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-bold text-gray-900">Jadwal Praktikum</h2><button onclick="showDashboard()" class="text-gray-400 hover:text-gray-600">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
         </svg></button>
       </div><!-- Week Navigation -->
       <div class="flex items-center justify-between mb-3"><button onclick="setWeek(0)" class="flex items-center px-3 py-1.5 text-sm bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors" id="thisWeekBtn"> Minggu Ini </button> <span class="text-base font-medium text-gray-700" id="currentWeekLabel">Minggu Ini</span> <button onclick="setWeek(1)" class="flex items-center px-3 py-1.5 text-sm bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors" id="nextWeekBtn"> Minggu Depan </button>
       </div><!-- Legend -->
       <div class="flex flex-wrap gap-3 mb-3 text-xs">
        <div class="flex items-center">
         <div class="w-2.5 h-2.5 bg-green-500 rounded mr-1"></div><span class="text-gray-600">Tersedia</span>
        </div>
        <div class="flex items-center">
         <div class="w-2.5 h-2.5 bg-red-500 rounded mr-1"></div><span class="text-gray-600">Terbooking</span>
        </div>
        <div class="flex items-center">
         <div class="w-2.5 h-2.5 bg-orange-500 rounded mr-1"></div><span class="text-gray-600">Berlangsung</span>
        </div>
       </div>
      </div><!-- Schedule Grid -->
      <div class="overflow-x-auto -mx-8 px-8">
       <div class="min-w-full"><!-- Days Header -->
        <div class="grid grid-cols-6 gap-2 mb-3">
         <div class="text-sm font-semibold text-gray-600 p-2 bg-gray-50 rounded text-center">
          Jam
         </div>
         <div class="text-sm font-semibold text-gray-700 p-2 bg-blue-50 rounded text-center">
          <div>
           Senin
          </div>
          <div class="text-xs text-gray-500 mt-1 font-medium" id="mondayDate"></div>
         </div>
         <div class="text-sm font-semibold text-gray-700 p-2 bg-blue-50 rounded text-center">
          <div>
           Selasa
          </div>
          <div class="text-xs text-gray-500 mt-1 font-medium" id="tuesdayDate"></div>
         </div>
         <div class="text-sm font-semibold text-gray-700 p-2 bg-blue-50 rounded text-center">
          <div>
           Rabu
          </div>
          <div class="text-xs text-gray-500 mt-1 font-medium" id="wednesdayDate"></div>
         </div>
         <div class="text-sm font-semibold text-gray-700 p-2 bg-blue-50 rounded text-center">
          <div>
           Kamis
          </div>
          <div class="text-xs text-gray-500 mt-1 font-medium" id="thursdayDate"></div>
         </div>
         <div class="text-sm font-semibold text-gray-700 p-2 bg-blue-50 rounded text-center">
          <div>
           Jumat
          </div>
          <div class="text-xs text-gray-500 mt-1 font-medium" id="fridayDate"></div>
         </div>
        </div><!-- Schedule Rows -->
        <div id="scheduleGrid" class="space-y-1.5"><!-- Schedule rows will be generated by JavaScript -->
        </div>
       </div>
      </div>
     </div><!-- Inventory Page -->
     <div id="inventoryPage" class="hidden">
      <div class="mb-4">
       <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-bold text-gray-900">ðŸ“¦ Data Inventaris Laboratorium</h2><button onclick="showDashboard()" class="text-gray-400 hover:text-gray-600">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
         </svg></button>
       </div><!-- Search and Filter -->
       <div class="mb-4 space-y-3">
        <div class="flex space-x-2"><input type="text" id="inventorySearch" placeholder="Cari nama alat..." class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none text-sm" onkeyup="filterInventory()"> <select id="categoryFilter" onchange="filterInventory()" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none text-sm"> <option value="">Semua Kategori</option> <option value="Model">Model &amp; Alat Peraga</option> <option value="Mikroskop">Mikroskop</option> <option value="Biologi">Biologi</option> <option value="Medis">Medis</option> <option value="Fisika">Fisika</option> <option value="Optik">Optik</option> <option value="Elektronik">Elektronik</option> <option value="Kimia">Kimia</option> <option value="Glassware">Glassware</option> </select> <button onclick="showAddItemForm()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium flex items-center space-x-1">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
          </svg><span>Tambah</span> </button>
        </div><!-- Status Filter -->
        <div class="flex space-x-2 text-xs"><button onclick="filterByStatus('all')" id="filterAll" class="px-3 py-1.5 bg-gray-600 text-white rounded-full font-medium"> Semua </button> <button onclick="filterByStatus('baik')" id="filterBaik" class="px-3 py-1.5 bg-gray-200 text-gray-700 rounded-full font-medium hover:bg-gray-300"> Baik </button> <button onclick="filterByStatus('kurang')" id="filterKurang" class="px-3 py-1.5 bg-gray-200 text-gray-700 rounded-full font-medium hover:bg-gray-300"> Kurang Baik </button> <button onclick="filterByStatus('rusak')" id="filterRusak" class="px-3 py-1.5 bg-gray-200 text-gray-700 rounded-full font-medium hover:bg-gray-300"> Rusak </button>
        </div>
       </div><!-- Summary Stats -->
       <div class="grid grid-cols-4 gap-2 mb-4 text-xs">
        <div class="bg-green-50 border border-green-200 p-3 rounded-lg text-center">
         <div class="font-bold text-green-800" id="totalItems">
          0
         </div>
         <div class="text-green-600">
          Total Item
         </div>
        </div>
        <div class="bg-blue-50 border border-blue-200 p-3 rounded-lg text-center">
         <div class="font-bold text-blue-800" id="goodItems">
          0
         </div>
         <div class="text-blue-600">
          Kondisi Baik
         </div>
        </div>
        <div class="bg-orange-50 border border-orange-200 p-3 rounded-lg text-center">
         <div class="font-bold text-orange-800" id="poorItems">
          0
         </div>
         <div class="text-orange-600">
          Kurang Baik
         </div>
        </div>
        <div class="bg-red-50 border border-red-200 p-3 rounded-lg text-center">
         <div class="font-bold text-red-800" id="damagedItems">
          0
         </div>
         <div class="text-red-600">
          Rusak
         </div>
        </div>
       </div>
      </div><!-- Add Item Form -->
      <div id="addItemForm" class="hidden mb-6 bg-green-50 border border-green-200 rounded-lg p-4">
       <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-green-800">âž• Tambah Alat Baru</h3><button onclick="hideAddItemForm()" class="text-green-600 hover:text-green-800">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
         </svg></button>
       </div>
       <form onsubmit="handleAddItem(event)" class="space-y-4">
        <div class="grid grid-cols-2 gap-4">
         <div><label for="newItemName" class="block text-sm font-medium text-gray-700 mb-1">Nama Alat</label> <input type="text" id="newItemName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none text-sm" placeholder="Contoh: Mikroskop Binokuler">
         </div>
         <div><label for="newItemCategory" class="block text-sm font-medium text-gray-700 mb-1">Kategori</label> <select id="newItemCategory" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none text-sm"> <option value="">Pilih Kategori</option> <option value="Model">Model &amp; Alat Peraga</option> <option value="Mikroskop">Mikroskop</option> <option value="Biologi">Biologi</option> <option value="Medis">Medis</option> <option value="Fisika">Fisika</option> <option value="Optik">Optik</option> <option value="Elektronik">Elektronik</option> <option value="Kimia">Kimia</option> <option value="Glassware">Glassware</option> </select>
         </div>
        </div>
        <div class="grid grid-cols-3 gap-4">
         <div><label for="newItemQuantity" class="block text-sm font-medium text-gray-700 mb-1">Jumlah</label> <input type="number" id="newItemQuantity" required min="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none text-sm" placeholder="1">
         </div>
         <div><label for="newItemUnit" class="block text-sm font-medium text-gray-700 mb-1">Satuan</label> <select id="newItemUnit" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none text-sm"> <option value="">Pilih Satuan</option> <option value="Buah">Buah</option> <option value="Set">Set</option> <option value="Pack">Pack</option> <option value="Pasang">Pasang</option> <option value="Unit">Unit</option> </select>
         </div>
         <div><label for="newItemCondition" class="block text-sm font-medium text-gray-700 mb-1">Kondisi</label> <select id="newItemCondition" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none text-sm"> <option value="">Pilih Kondisi</option> <option value="baik">Baik</option> <option value="kurang">Kurang Baik</option> <option value="rusak">Rusak</option> </select>
         </div>
        </div>
        <div><label for="newItemDescription" class="block text-sm font-medium text-gray-700 mb-1">Keterangan</label> <textarea id="newItemDescription" required rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none text-sm resize-none" placeholder="Contoh: Mikroskop dengan perbesaran 40x-1000x, kondisi lensa baik"></textarea>
        </div>
        <div class="flex space-x-3 pt-2"><button type="button" onclick="hideAddItemForm()" class="flex-1 bg-gray-200 text-gray-700 py-2 px-4 rounded-lg font-medium hover:bg-gray-300 transition-colors text-sm"> Batal </button> <button type="submit" id="addItemBtn" class="flex-1 bg-green-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-green-700 transition-colors text-sm disabled:opacity-50"> Tambah Alat </button>
        </div>
       </form>
      </div><!-- Inventory List -->
      <div class="space-y-1.5 max-h-72 overflow-y-auto" id="inventoryList"><!-- Inventory items will be displayed here -->
      </div><!-- Loading State -->
      <div id="inventoryLoading" class="text-center py-8">
       <svg class="w-8 h-8 mx-auto mb-3 text-green-500 animate-spin" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
       </svg>
       <p class="text-sm text-gray-600">Memuat data inventaris...</p>
      </div>
     </div><!-- Incident Report Form Page -->
     <div id="incidentFormPage" class="auth-form hidden">
      <div class="mb-6">
       <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-bold text-gray-900">Form Pengaduan Insiden</h2>
        <div class="flex items-center space-x-3"><button onclick="showIncidentSummary()" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors flex items-center space-x-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 00-2-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
          </svg><span>Rekap Laporan Insiden</span> </button> <button onclick="showDashboard()" class="text-gray-400 hover:text-gray-600">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg></button>
        </div>
       </div>
      </div>
      <form onsubmit="handleIncidentSubmit(event)" class="space-y-4">
       <div><label for="incidentTeacherSelect" class="block text-sm font-medium text-gray-700 mb-2">Nama Guru Pelapor</label> <select id="incidentTeacherSelect" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none"> <option value="">Pilih Guru</option> <option value="Siti Anidah P., S.Pd (3)">Siti Anidah P., S.Pd (3)</option> <option value="Nurhayati Ningsih, S.Pd (7)">Nurhayati Ningsih, S.Pd (7)</option> <option value="Wiwin Andarie, S.Pd, M.Psi (16)">Wiwin Andarie, S.Pd, M.Psi (16)</option> <option value="Suci Alima, S.Si, M.Pd (22)">Suci Alima, S.Si, M.Pd (22)</option> <option value="Mahmud S.Pd (39)">Mahmud S.Pd (39)</option> <option value="Nurul Adi Setiyawan, S.Pd (46b)">Nurul Adi Setiyawan, S.Pd (46b)</option> <option value="Shelma Rahmadita, S.Pd (47b)">Shelma Rahmadita, S.Pd (47b)</option> </select>
       </div>
       <div><label for="incidentClassSelect" class="block text-sm font-medium text-gray-700 mb-2">Kelas</label> <select id="incidentClassSelect" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none"> <option value="">Pilih Kelas</option> <optgroup label="Kelas VII"> <option value="VII A">VII A</option> <option value="VII B">VII B</option> <option value="VII C">VII C</option> <option value="VII D">VII D</option> <option value="VII E">VII E</option> <option value="VII F">VII F</option> <option value="VII G">VII G</option> <option value="VII H">VII H</option> <option value="VII I">VII I</option> <option value="VII J">VII J</option> </optgroup> <optgroup label="Kelas VIII"> <option value="VIII A">VIII A</option> <option value="VIII B">VIII B</option> <option value="VIII C">VIII C</option> <option value="VIII D">VIII D</option> <option value="VIII E">VIII E</option> <option value="VIII F">VIII F</option> <option value="VIII G">VIII G</option> <option value="VIII H">VIII H</option> <option value="VIII I">VIII I</option> <option value="VIII J">VIII J</option> </optgroup> <optgroup label="Kelas IX"> <option value="IX A">IX A</option> <option value="IX B">IX B</option> <option value="IX C">IX C</option> <option value="IX D">IX D</option> <option value="IX E">IX E</option> <option value="IX F">IX F</option> <option value="IX G">IX G</option> <option value="IX H">IX H</option> <option value="IX I">IX I</option> <option value="IX J">IX J</option> </optgroup> </select>
       </div>
       <div class="grid grid-cols-2 gap-4">
        <div><label for="incidentDate" class="block text-sm font-medium text-gray-700 mb-2">Tanggal Kejadian</label> <input type="date" id="incidentDate" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none">
        </div>
        <div><label for="incidentTime" class="block text-sm font-medium text-gray-700 mb-2">Waktu Insiden</label> <input type="time" id="incidentTime" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none">
        </div>
       </div>
       <div><label for="incidentReport" class="block text-sm font-medium text-gray-700 mb-2">Laporan Kejadian</label> <textarea id="incidentReport" required rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none resize-none" placeholder="Contoh: Terdapat 3 buah preparat yang pecah saat praktikum mikroskop"></textarea>
        <div class="mt-2 text-xs text-gray-500">
         Deskripsikan kejadian kerusakan alat dengan detail dan jelas
        </div>
       </div>
       <div><label for="actionTaken" class="block text-sm font-medium text-gray-700 mb-2">Tindakan yang Sudah Dilakukan</label> <textarea id="actionTaken" required rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none resize-none" placeholder="Contoh: Membersihkan pecahan kaca, mengganti 3 pipet tetes yang rusak dengan yang baru"></textarea>
        <div class="mt-2 text-xs text-gray-500"><strong>Jelaskan tindakan yang telah dilakukan untuk mengatasi masalah.</strong><br><em>Contoh:</em> "Mengganti 3 gelas kimia 300ml yang pecah dengan yang baru dari gudang, membersihkan pecahan kaca, dan memperbaiki 1 mikroskop binokuler yang rusak"
        </div>
       </div>
       <div class="bg-yellow-50 border border-yellow-200 p-3 rounded-lg">
        <div class="flex items-start">
         <svg class="w-5 h-5 text-yellow-600 mt-0.5 mr-2" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
         </svg>
         <div class="text-sm text-yellow-800"><strong>Informasi:</strong> Laporan akan otomatis terkirim ke sistem spreadsheet untuk ditindaklanjuti oleh tim laboratorium.
         </div>
        </div>
       </div>
       <div class="flex space-x-3 pt-4"><button type="button" onclick="showDashboard()" class="flex-1 bg-gray-200 text-gray-700 py-2 px-4 rounded-lg font-medium hover:bg-gray-300 transition-colors"> Batal </button> <button type="submit" id="incidentSubmitBtn" class="flex-1 bg-red-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-red-700 transition-colors disabled:opacity-50"> Kirim Laporan </button>
       </div>
      </form><!-- Incident Reports History -->
      <div class="mt-8 border-t pt-6">
       <h3 class="text-lg font-semibold text-gray-900 mb-4">ðŸ“‹ Rekap Laporan Insiden</h3>
       <div id="incidentHistory" class="space-y-2 max-h-64 overflow-y-auto"><!-- Incident reports will be displayed here -->
       </div>
       <div id="noIncidents" class="text-center py-8 text-gray-500">
        <svg class="w-12 h-12 mx-auto mb-3 text-gray-300" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        <p class="text-sm">Belum ada laporan insiden yang tercatat</p>
       </div>
      </div>
     </div><!-- Incident Summary Page -->
     <div id="incidentSummaryPage" class="auth-form hidden">
      <div class="mb-6">
       <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-bold text-gray-900">ðŸ“Š Rekap Laporan Insiden</h2>
        <div class="flex items-center space-x-3"><button onclick="exportIncidentSummary()" class="bg-green-600 text-white px-3 py-2 rounded-lg text-sm font-medium hover:bg-green-700 transition-colors flex items-center space-x-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg><span>Export</span> </button> <button onclick="showIncidentForm()" class="text-gray-400 hover:text-gray-600">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg></button>
        </div>
       </div><!-- Summary Statistics -->
       <div class="grid grid-cols-4 gap-3 mb-6">
        <div class="bg-red-50 border border-red-200 p-3 rounded-lg text-center">
         <div class="font-bold text-red-800 text-lg" id="totalIncidents">
          0
         </div>
         <div class="text-red-600 text-xs">
          Total Insiden
         </div>
        </div>
        <div class="bg-orange-50 border border-orange-200 p-3 rounded-lg text-center">
         <div class="font-bold text-orange-800 text-lg" id="totalDamagedItems">
          0
         </div>
         <div class="text-orange-600 text-xs">
          Alat Rusak
         </div>
        </div>
        <div class="bg-green-50 border border-green-200 p-3 rounded-lg text-center">
         <div class="font-bold text-green-800 text-lg" id="totalReplacedItems">
          0
         </div>
         <div class="text-green-600 text-xs">
          Alat Diganti
         </div>
        </div>
        <div class="bg-blue-50 border border-blue-200 p-3 rounded-lg text-center">
         <div class="font-bold text-blue-800 text-lg" id="thisMonthIncidents">
          0
         </div>
         <div class="text-blue-600 text-xs">
          Bulan Ini
         </div>
        </div>
       </div><!-- Filter Controls -->
       <div class="flex space-x-3 mb-4"><select id="monthFilter" onchange="filterIncidentsByMonth()" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none text-sm"> <option value="">Semua Bulan</option> <option value="0">Januari</option> <option value="1">Februari</option> <option value="2">Maret</option> <option value="3">April</option> <option value="4">Mei</option> <option value="5">Juni</option> <option value="6">Juli</option> <option value="7">Agustus</option> <option value="8">September</option> <option value="9">Oktober</option> <option value="10">November</option> <option value="11">Desember</option> </select> <select id="teacherFilter" onchange="filterIncidentsByTeacher()" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none text-sm"> <option value="">Semua Guru</option> <option value="Siti Anidah P., S.Pd (3)">Siti Anidah P., S.Pd (3)</option> <option value="Nurhayati Ningsih, S.Pd (7)">Nurhayati Ningsih, S.Pd (7)</option> <option value="Wiwin Andarie, S.Pd, M.Psi (16)">Wiwin Andarie, S.Pd, M.Psi (16)</option> <option value="Suci Alima, S.Si, M.Pd (22)">Suci Alima, S.Si, M.Pd (22)</option> <option value="Mahmud S.Pd (39)">Mahmud S.Pd (39)</option> <option value="Nurul Adi Setiyawan, S.Pd (46b)">Nurul Adi Setiyawan, S.Pd (46b)</option> <option value="Shelma Rahmadita, S.Pd (47b)">Shelma Rahmadita, S.Pd (47b)</option> </select> <button onclick="resetIncidentFilters()" class="px-3 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors text-sm"> Reset Filter </button>
       </div>
      </div><!-- Incident Summary List -->
      <div class="space-y-3 max-h-96 overflow-y-auto" id="incidentSummaryList"><!-- Summary items will be displayed here -->
      </div><!-- Loading State -->
      <div id="summaryLoading" class="text-center py-8 hidden">
       <svg class="w-8 h-8 mx-auto mb-3 text-blue-500 animate-spin" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
       </svg>
       <p class="text-sm text-gray-600">Memuat rekap laporan...</p>
      </div><!-- No Data State -->
      <div id="noSummaryData" class="text-center py-8 hidden">
       <svg class="w-12 h-12 mx-auto mb-3 text-gray-300" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
       </svg>
       <p class="text-sm text-gray-500">Belum ada laporan insiden yang tercatat</p><button onclick="showIncidentForm()" class="mt-3 bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors"> Buat Laporan Pertama </button>
      </div>
     </div>
    </div><!-- Floating Elements -->
    <div class="absolute top-20 left-10 w-16 h-16 bg-white bg-opacity-10 rounded-full pulse-animation hidden md:block"></div>
    <div class="absolute top-40 right-20 w-12 h-12 bg-white bg-opacity-15 rounded-full pulse-animation hidden md:block" style="animation-delay: 0.5s;"></div>
    <div class="absolute bottom-32 left-1/4 w-8 h-8 bg-white bg-opacity-20 rounded-full pulse-animation hidden md:block" style="animation-delay: 1s;"></div>
   </div>
  </div>
  <script>
        // Default configuration
        const defaultConfig = {
            site_title: "DigiLabo",
            hero_subtitle: "Solusi lengkap manajemen laboratorium SMP Negeri 26 Surabaya",
            login_title: "Masuk ke Sistem",
            register_title: "Daftar Akun Baru",
            background_color: "#667eea",
            surface_color: "#ffffff",
            text_color: "#1f2937",
            primary_action_color: "#4f46e5",
            secondary_action_color: "#6b7280",
            font_family: "Inter",
            font_size: 16
        };

        // Global variables
        let userData = [];
        let currentUser = null;
        let incidentReports = [];
        let inventoryData = [];
        let filteredInventoryData = [];
        let currentStatusFilter = 'all';

        // Render function
        async function render(config) {
            const customFont = config.font_family || defaultConfig.font_family;
            const baseSize = config.font_size || defaultConfig.font_size;
            const baseFontStack = 'system-ui, -apple-system, sans-serif';

            // Update text content
            document.getElementById('site-title').textContent = config.site_title || defaultConfig.site_title;
            document.getElementById('hero-subtitle').textContent = config.hero_subtitle || defaultConfig.hero_subtitle;
            document.getElementById('login-title').textContent = config.login_title || defaultConfig.login_title;
            document.getElementById('register-title').textContent = config.register_title || defaultConfig.register_title;

            // Apply colors
            const backgroundColor = config.background_color || defaultConfig.background_color;
            const surfaceColor = config.surface_color || defaultConfig.surface_color;
            const textColor = config.text_color || defaultConfig.text_color;
            const primaryActionColor = config.primary_action_color || defaultConfig.primary_action_color;
            const secondaryActionColor = config.secondary_action_color || defaultConfig.secondary_action_color;

            // Update gradient background
            document.body.style.background = `linear-gradient(135deg, ${backgroundColor} 0%, #764ba2 100%)`;

            // Update surface colors
            document.querySelectorAll('.auth-card').forEach(el => {
                el.style.backgroundColor = `rgba(255, 255, 255, 0.95)`;
            });

            // Update text colors
            document.querySelectorAll('.text-gray-900').forEach(el => {
                el.style.color = textColor;
            });

            // Update primary action colors
            document.querySelectorAll('.bg-indigo-600, .text-indigo-600').forEach(el => {
                if (el.classList.contains('bg-indigo-600')) {
                    el.style.backgroundColor = primaryActionColor;
                } else {
                    el.style.color = primaryActionColor;
                }
            });

            // Update secondary action colors
            document.querySelectorAll('.text-gray-600').forEach(el => {
                el.style.color = secondaryActionColor;
            });

            // Apply fonts
            document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;

            // Apply font sizes
            document.getElementById('site-title').style.fontSize = `${baseSize * 2.5}px`;
            document.getElementById('hero-subtitle').style.fontSize = `${baseSize * 1.125}px`;
            document.getElementById('login-title').style.fontSize = `${baseSize * 1.5}px`;
            document.getElementById('register-title').style.fontSize = `${baseSize * 1.5}px`;
        }

        // Capabilities mapping
        function mapToCapabilities(config) {
            return {
                recolorables: [
                    {
                        get: () => config.background_color || defaultConfig.background_color,
                        set: (value) => {
                            config.background_color = value;
                            window.elementSdk.setConfig({ background_color: value });
                        }
                    },
                    {
                        get: () => config.surface_color || defaultConfig.surface_color,
                        set: (value) => {
                            config.surface_color = value;
                            window.elementSdk.setConfig({ surface_color: value });
                        }
                    },
                    {
                        get: () => config.text_color || defaultConfig.text_color,
                        set: (value) => {
                            config.text_color = value;
                            window.elementSdk.setConfig({ text_color: value });
                        }
                    },
                    {
                        get: () => config.primary_action_color || defaultConfig.primary_action_color,
                        set: (value) => {
                            config.primary_action_color = value;
                            window.elementSdk.setConfig({ primary_action_color: value });
                        }
                    },
                    {
                        get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                        set: (value) => {
                            config.secondary_action_color = value;
                            window.elementSdk.setConfig({ secondary_action_color: value });
                        }
                    }
                ],
                borderables: [],
                fontEditable: {
                    get: () => config.font_family || defaultConfig.font_family,
                    set: (value) => {
                        config.font_family = value;
                        window.elementSdk.setConfig({ font_family: value });
                    }
                },
                fontSizeable: {
                    get: () => config.font_size || defaultConfig.font_size,
                    set: (value) => {
                        config.font_size = value;
                        window.elementSdk.setConfig({ font_size: value });
                    }
                }
            };
        }

        // Edit panel values mapping
        function mapToEditPanelValues(config) {
            return new Map([
                ["site_title", config.site_title || defaultConfig.site_title],
                ["hero_subtitle", config.hero_subtitle || defaultConfig.hero_subtitle],
                ["login_title", config.login_title || defaultConfig.login_title],
                ["register_title", config.register_title || defaultConfig.register_title]
            ]);
        }

        // Data SDK Handler
        const dataHandler = {
            onDataChanged(data) {
                userData = data;
            }
        };

        // Initialize Data SDK
        async function initDataSdk() {
            if (window.dataSdk) {
                const result = await window.dataSdk.init(dataHandler);
                if (!result.isOk) {
                    console.error("Failed to initialize data SDK");
                }
            }
        }

        // Auth functions
        function showLoginForm() {
            hideAllForms();
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('loginForm').classList.add('slide-in');
            clearErrors();
            clearForms();
        }

        function showRegisterForm() {
            hideAllForms();
            document.getElementById('registerForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('slide-in');
            clearErrors();
        }

        function showSuccessMessage(message) {
            hideAllForms();
            document.getElementById('successMessage').classList.remove('hidden');
            document.getElementById('successMessage').classList.add('slide-in');
            document.getElementById('welcomeMessage').textContent = message;
        }

        function showDashboard() {
            hideAllForms();
            document.getElementById('dashboardPreview').classList.remove('hidden');
            document.getElementById('dashboardPreview').classList.add('slide-in');
            if (currentUser) {
                document.getElementById('userWelcome').textContent = `Selamat datang, ${currentUser.nama_lengkap}!`;
            }
        }

        function hideAllForms() {
            const forms = ['loginForm', 'registerForm', 'successMessage', 'dashboardPreview', 'schedulePage', 'inventoryPage', 'incidentFormPage', 'incidentSummaryPage'];
            forms.forEach(formId => {
                document.getElementById(formId).classList.add('hidden');
                document.getElementById(formId).classList.remove('slide-in');
            });
            
            // Reset container size when hiding forms
            const mainContainer = document.getElementById('mainContainer');
            if (!document.getElementById('schedulePage').classList.contains('hidden') || 
                !document.getElementById('incidentSummaryPage').classList.contains('hidden')) {
                // Keep expanded if schedule or summary is showing
                return;
            }
            mainContainer.classList.remove('max-w-6xl', 'max-w-4xl');
            mainContainer.classList.add('max-w-md');
        }

        function clearErrors() {
            document.getElementById('loginError').classList.add('hidden');
            document.getElementById('registerError').classList.add('hidden');
        }

        function clearForms() {
            document.getElementById('loginForm').querySelector('form').reset();
            document.getElementById('registerForm').querySelector('form').reset();
        }

        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            const errorTextElement = document.getElementById(elementId + 'Text');
            errorTextElement.textContent = message;
            errorElement.classList.remove('hidden');
        }

        function togglePassword(inputId, toggleId) {
            const input = document.getElementById(inputId);
            const toggle = document.getElementById(toggleId);
            
            if (input.type === 'password') {
                input.type = 'text';
                toggle.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"></path>
                `;
            } else {
                input.type = 'password';
                toggle.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                `;
            }
        }

        async function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const loginBtn = document.getElementById('loginBtn');

            if (userData.length >= 999) {
                showError('loginError', 'Sistem telah mencapai batas maksimum pengguna. Silakan hubungi administrator.');
                return;
            }

            // Show loading state
            loginBtn.textContent = 'Memproses...';
            loginBtn.disabled = true;
            clearErrors();

            try {
                // Find user in stored data
                const user = userData.find(u => u.email === email && u.password === password);
                
                if (user) {
                    currentUser = user;
                    showSuccessMessage(`Selamat datang kembali, ${user.nama_lengkap}!`);
                    
                    // Auto redirect to dashboard after 2 seconds
                    setTimeout(() => {
                        showDashboard();
                    }, 2000);
                } else {
                    showError('loginError', 'Email atau password tidak valid. Silakan periksa kembali atau daftar akun baru.');
                }
            } catch (error) {
                showError('loginError', 'Terjadi kesalahan saat masuk. Silakan coba lagi.');
            } finally {
                // Reset button state
                loginBtn.textContent = 'Masuk';
                loginBtn.disabled = false;
            }
        }

async function handleRegister(event) {
    event.preventDefault();

    const name = document.getElementById('registerName').value.trim();
    const email = document.getElementById('registerEmail').value.trim();
    const password = document.getElementById('registerPassword').value.trim();
    const confirmPassword = document.getElementById('confirmPassword').value.trim();
    const registerBtn = document.getElementById('registerBtn');

    // Tombol loading state
    registerBtn.textContent = 'Memproses...';
    registerBtn.disabled = true;

    try {
        // Validasi sederhana password
        if (password.length < 6) {
            showError('registerError', 'Password harus memiliki minimal 6 karakter.');
            return;
        }
        if (password !== confirmPassword) {
            showError('registerError', 'Konfirmasi password tidak sesuai.');
            return;
        }

        // Buat objek user baru
        const newUser = {
            name,
            email,
            password,
            createdAt: new Date().toISOString(),
        };

        // âœ… Langsung masuk tanpa konfirmasi data / SDK
        currentUser = newUser;

        // Tampilkan pesan sukses
        showSuccessMessage(`Selamat datang, ${name}! Akun Anda berhasil dibuat dan siap digunakan.`);

        // Redirect otomatis ke dashboard setelah 2 detik
        setTimeout(() => {
            showDashboard();
        }, 2000);

    } catch (error) {
        showError('registerError', 'Terjadi kesalahan saat mendaftar. Silakan coba lagi.');
    } finally {
        // Kembalikan tombol
        registerBtn.textContent = 'Daftar Akun';
        registerBtn.disabled = false;
    }
}

        // Initialize Element SDK
        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                render,
                mapToCapabilities,
                mapToEditPanelValues
            });
        }

        // Schedule management
        let currentWeekOffset = 0;
        let bookings = [];
        let selectedBookingSlot = null;
        
        const timeSlots = [
            { start: '07:00', end: '07:40' },
            { start: '07:40', end: '08:20' },
            { start: '08:20', end: '09:00' },
            { start: '09:00', end: '09:40' },
            { start: '09:40', end: '10:10' },
            { start: '10:10', end: '10:50' },
            { start: '10:50', end: '11:30' },
            { start: '11:30', end: '12:20' },
            { start: '12:20', end: '13:00' },
            { start: '13:00', end: '13:40' },
            { start: '13:40', end: '14:20' }
        ];

        function showSchedulePage() {
            hideAllForms();
            document.getElementById('schedulePage').classList.remove('hidden');
            document.getElementById('schedulePage').classList.add('slide-in');
            
            // Expand container for schedule view
            const mainContainer = document.getElementById('mainContainer');
            mainContainer.classList.remove('max-w-md');
            mainContainer.classList.add('max-w-6xl');
            
            generateScheduleGrid();
            updateWeekLabel();
            updateWeekDates();
            
            // Set initial week button state
            setWeek(currentWeekOffset);
        }

        function setWeek(weekOffset) {
            currentWeekOffset = weekOffset;
            updateWeekLabel();
            generateScheduleGrid();
            updateWeekDates();
            
            // Update button states
            const thisWeekBtn = document.getElementById('thisWeekBtn');
            const nextWeekBtn = document.getElementById('nextWeekBtn');
            
            if (weekOffset === 0) {
                thisWeekBtn.classList.add('bg-indigo-600', 'text-white');
                thisWeekBtn.classList.remove('bg-gray-100', 'hover:bg-gray-200');
                nextWeekBtn.classList.remove('bg-indigo-600', 'text-white');
                nextWeekBtn.classList.add('bg-gray-100', 'hover:bg-gray-200');
            } else {
                nextWeekBtn.classList.add('bg-indigo-600', 'text-white');
                nextWeekBtn.classList.remove('bg-gray-100', 'hover:bg-gray-200');
                thisWeekBtn.classList.remove('bg-indigo-600', 'text-white');
                thisWeekBtn.classList.add('bg-gray-100', 'hover:bg-gray-200');
            }
        }

        function updateWeekLabel() {
            const label = document.getElementById('currentWeekLabel');
            if (currentWeekOffset === 0) {
                label.textContent = 'Minggu Ini';
            } else if (currentWeekOffset === 1) {
                label.textContent = 'Minggu Depan';
            }
        }

        function updateWeekDates() {
            const today = new Date();
            const currentDay = today.getDay(); // 0 = Sunday, 1 = Monday, etc.
            const mondayOffset = currentDay === 0 ? -6 : 1 - currentDay; // Get Monday of current week
            
            const monday = new Date(today);
            monday.setDate(today.getDate() + mondayOffset + (currentWeekOffset * 7));
            
            const dateElements = ['mondayDate', 'tuesdayDate', 'wednesdayDate', 'thursdayDate', 'fridayDate'];
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
            
            dateElements.forEach((elementId, index) => {
                const date = new Date(monday);
                date.setDate(monday.getDate() + index);
                
                const element = document.getElementById(elementId);
                if (element) {
                    element.textContent = `${date.getDate()} ${months[date.getMonth()]}`;
                }
            });
        }

        function updateRealTimeClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('id-ID', { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            });
            const dateString = now.toLocaleDateString('id-ID', { 
                weekday: 'short', 
                day: 'numeric', 
                month: 'short', 
                year: 'numeric' 
            });
            
            const clockElement = document.getElementById('realTimeClock');
            const dateElement = document.getElementById('realTimeDate');
            
            if (clockElement) clockElement.textContent = timeString;
            if (dateElement) dateElement.textContent = dateString;
        }

        function generateScheduleGrid() {
            const grid = document.getElementById('scheduleGrid');
            grid.innerHTML = '';

            timeSlots.forEach((slot, slotIndex) => {
                // Skip slots after 11:30 on Friday
                const fridayLimit = slot.start >= '11:30' && slot.start !== '11:30';
                
                const row = document.createElement('div');
                row.className = 'grid grid-cols-6 gap-2';

                // Time column
                const timeCell = document.createElement('div');
                timeCell.className = 'text-sm text-gray-700 p-2 font-mono bg-gray-50 rounded text-center font-semibold';
                timeCell.textContent = `${slot.start}-${slot.end}`;
                row.appendChild(timeCell);

                // Day columns (Monday to Friday)
                for (let day = 0; day < 5; day++) {
                    const cell = document.createElement('div');
                    cell.className = 'p-0.5';

                    if (day === 4 && fridayLimit) {
                        // Friday after 11:30 - not available
                        cell.innerHTML = '<div class="bg-gray-200 rounded text-sm p-2 text-center text-gray-400 font-medium min-h-[32px] flex items-center justify-center">-</div>';
                    } else {
                        const status = getSlotStatus(day, slotIndex);
                        const allBookings = getAllBookingsForSlot(day, slotIndex);
                        const booking = getBookingForSlot(day, slotIndex);
                        
                        let bgColor = 'bg-green-500';
                        let textColor = 'text-white';
                        let content = 'Tersedia';
                        
                        if (status === 'booked') {
                            bgColor = 'bg-red-500';
                            if (allBookings.length > 1) {
                                content = `${allBookings.length} Kelas`;
                            } else {
                                content = booking ? booking.class : 'Terbooking';
                            }
                        } else if (status === 'ongoing') {
                            bgColor = 'bg-orange-500';
                            if (allBookings.length > 1) {
                                content = `${allBookings.length} Kelas`;
                            } else {
                                content = booking ? booking.class : 'Berlangsung';
                            }
                        }

                        const button = document.createElement('button');
                        button.className = `w-full ${bgColor} ${textColor} rounded text-sm p-2 hover:opacity-80 transition-opacity font-semibold min-h-[32px] flex items-center justify-center shadow-sm`;
                        button.textContent = content;
                        button.onclick = () => handleSlotClick(day, slotIndex, status);
                        
                        // Add cursor pointer and tooltips
                        if (status === 'available') {
                            button.style.cursor = 'pointer';
                            button.title = 'Klik untuk booking slot ini';
                        } else if (status === 'booked') {
                            button.style.cursor = 'pointer';
                            if (allBookings.length > 1) {
                                button.title = `${allBookings.length} kelas terbooking - klik untuk detail`;
                            } else {
                                button.title = 'Klik untuk melihat detail booking';
                            }
                        } else if (status === 'ongoing') {
                            button.style.cursor = 'pointer';
                            if (allBookings.length > 1) {
                                button.title = `${allBookings.length} kelas sedang praktikum - klik untuk detail`;
                            } else {
                                button.title = 'Praktikum sedang berlangsung - klik untuk detail';
                            }
                        }
                        
                        cell.appendChild(button);
                    }
                    
                    row.appendChild(cell);
                }

                grid.appendChild(row);
            });
        }

        function getSlotStatus(day, slotIndex) {
            const now = new Date();
            const currentDay = now.getDay() - 1; // Convert to 0-4 (Mon-Fri)
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            const currentTime = currentHour * 60 + currentMinute;
            
            const slot = timeSlots[slotIndex];
            const slotStart = parseInt(slot.start.split(':')[0]) * 60 + parseInt(slot.start.split(':')[1]);
            const slotEnd = parseInt(slot.end.split(':')[0]) * 60 + parseInt(slot.end.split(':')[1]);

            // Check if there's a booking for this slot
            const booking = getBookingForSlot(day, slotIndex);
            
            if (booking) {
                // If it's current week, current day, and current time is within slot
                if (currentWeekOffset === 0 && day === currentDay && currentTime >= slotStart && currentTime <= slotEnd) {
                    return 'ongoing';
                }
                // Always show as booked if there's a booking (no time restriction)
                return 'booked';
            }
            
            return 'available';
        }

        function getBookingForSlot(day, slotIndex) {
            // Return the first booking found for this slot (allows multiple bookings)
            return bookings.find(booking => 
                booking.day === day && 
                booking.slotIndex === slotIndex && 
                booking.weekOffset === currentWeekOffset
            );
        }

        function getAllBookingsForSlot(day, slotIndex) {
            // Return all bookings for this slot
            return bookings.filter(booking => 
                booking.day === day && 
                booking.slotIndex === slotIndex && 
                booking.weekOffset === currentWeekOffset
            );
        }

        function handleSlotClick(day, slotIndex, status) {
            if (status === 'ongoing' || status === 'booked') {
                const allBookings = getAllBookingsForSlot(day, slotIndex);
                if (allBookings.length > 1) {
                    showMultipleBookingDetails(allBookings, day, slotIndex);
                } else if (allBookings.length === 1) {
                    showBookingDetails(allBookings[0]);
                }
                return;
            }

            // Available slot - show booking form
            showBookingForm(day, slotIndex);
        }

        function showBookingForm(day, slotIndex) {
            selectedBookingSlot = { day, slotIndex, weekOffset: currentWeekOffset };
            
            const dayNames = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat'];
            const slot = timeSlots[slotIndex];
            const weekLabel = currentWeekOffset === 0 ? 'Minggu Ini' : 'Minggu Depan';
            
            document.getElementById('selectedSlotInfo').textContent = 
                `${dayNames[day]}, ${slot.start}-${slot.end} (${weekLabel})`;
            
            document.getElementById('bookingFormModal').classList.remove('hidden');
            
            // Reset form
            document.getElementById('bookingTeacher').value = '';
            document.getElementById('bookingClass').value = '';
            document.getElementById('bookingSubject').value = '';
            document.getElementById('bookingNotes').value = '';
        }

        function hideBookingForm() {
            document.getElementById('bookingFormModal').classList.add('hidden');
            selectedBookingSlot = null;
        }

        async function handleBookingSubmit(event) {
            event.preventDefault();
            
            if (!selectedBookingSlot) return;
            
            const teacher = document.getElementById('bookingTeacher').value;
            const className = document.getElementById('bookingClass').value;
            const subject = document.getElementById('bookingSubject').value;
            const notes = document.getElementById('bookingNotes').value;
            const submitBtn = document.getElementById('bookingSubmitBtn');
            
            // Show loading state
            submitBtn.textContent = 'Memproses...';
            submitBtn.disabled = true;
            
            try {
                // Simulate booking process
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Create booking
                const newBooking = {
                    id: Date.now().toString(),
                    day: selectedBookingSlot.day,
                    slotIndex: selectedBookingSlot.slotIndex,
                    weekOffset: selectedBookingSlot.weekOffset,
                    class: className,
                    teacher: teacher,
                    subject: subject,
                    notes: notes,
                    bookedBy: currentUser ? currentUser.nama_lengkap : 'Unknown User',
                    bookedAt: new Date().toISOString()
                };
                
                // Add to bookings array
                bookings.push(newBooking);
                
                // Update schedule display
                generateScheduleGrid();
                
                // Show success message
                const dayNames = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat'];
                const slot = timeSlots[selectedBookingSlot.slotIndex];
                const weekLabel = selectedBookingSlot.weekOffset === 0 ? 'Minggu Ini' : 'Minggu Depan';
                
                showMessage(`Booking berhasil!\n\nKelas: ${className}\nGuru: ${teacher}\nWaktu: ${dayNames[selectedBookingSlot.day]}, ${slot.start}-${slot.end} (${weekLabel})\nMateri: ${subject}`, 'success');
                
                // Hide form
                hideBookingForm();
                
            } catch (error) {
                showMessage('Gagal melakukan booking. Silakan coba lagi.', 'error');
            } finally {
                submitBtn.textContent = 'Booking Sekarang';
                submitBtn.disabled = false;
            }
        }

        function showMultipleBookingDetails(allBookings, day, slotIndex) {
            const dayNames = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat'];
            const slot = timeSlots[slotIndex];
            const weekLabel = currentWeekOffset === 0 ? 'Minggu Ini' : 'Minggu Depan';
            
            // Create custom modal for multiple booking details
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            
            const bookingListHtml = allBookings.map((booking, index) => `
                <div class="p-3 bg-gray-50 border border-gray-200 rounded-lg mb-3">
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="font-semibold text-gray-900">Booking #${index + 1}</h4>
                        <button onclick="cancelBooking('${booking.id}'); this.closest('.fixed').remove(); setTimeout(() => generateScheduleGrid(), 100);" 
                                class="text-red-600 hover:text-red-800 text-sm font-medium">
                            Batalkan
                        </button>
                    </div>
                    <div class="text-sm text-gray-700 space-y-1">
                        <div><strong>Kelas:</strong> ${booking.class}</div>
                        <div><strong>Guru:</strong> ${booking.teacher}</div>
                        <div><strong>Materi:</strong> ${booking.subject}</div>
                        ${booking.notes ? `<div><strong>Catatan:</strong> ${booking.notes}</div>` : ''}
                        <div class="text-xs text-gray-500 mt-2">
                            Dibooking oleh: ${booking.bookedBy} pada ${new Date(booking.bookedAt).toLocaleString('id-ID')}
                        </div>
                    </div>
                </div>
            `).join('');
            
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-full max-w-lg max-h-[80vh] overflow-y-auto">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-900">Detail Multiple Booking</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="p-3 bg-blue-50 border border-blue-200 rounded-lg mb-4">
                        <div class="text-sm">
                            <div class="font-semibold text-blue-900 mb-2">ðŸ“… Jadwal Slot</div>
                            <div class="text-blue-800">
                                <strong>Hari:</strong> ${dayNames[day]}<br>
                                <strong>Waktu:</strong> ${slot.start} - ${slot.end}<br>
                                <strong>Periode:</strong> ${weekLabel}<br>
                                <strong>Total Booking:</strong> ${allBookings.length} kelas
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-3 mb-6">
                        <h4 class="font-semibold text-gray-900">ðŸ“‹ Daftar Kelas:</h4>
                        ${bookingListHtml}
                    </div>
                    
                    <div class="flex space-x-3">
                        <button onclick="this.closest('.fixed').remove()" 
                                class="flex-1 bg-gray-200 text-gray-700 py-2 px-4 rounded-lg font-medium hover:bg-gray-300 transition-colors">
                            Tutup
                        </button>
                        <button onclick="showBookingForm(${day}, ${slotIndex}); this.closest('.fixed').remove()" 
                                class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-blue-700 transition-colors">
                            Tambah Booking Lagi
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function showBookingDetails(booking) {
            const dayNames = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat'];
            const slot = timeSlots[booking.slotIndex];
            const weekLabel = booking.weekOffset === 0 ? 'Minggu Ini' : 'Minggu Depan';
            
            // Create custom modal for booking details with cancel option
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-full max-w-md">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-900">Detail Booking</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="space-y-3 mb-6">
                        <div class="p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <div class="text-sm">
                                <div class="font-semibold text-blue-900 mb-2">ðŸ“… Jadwal</div>
                                <div class="text-blue-800">
                                    <strong>Hari:</strong> ${dayNames[booking.day]}<br>
                                    <strong>Waktu:</strong> ${slot.start} - ${slot.end}<br>
                                    <strong>Periode:</strong> ${weekLabel}
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-3 bg-green-50 border border-green-200 rounded-lg">
                            <div class="text-sm">
                                <div class="font-semibold text-green-900 mb-2">ðŸ‘¥ Kelas & Guru</div>
                                <div class="text-green-800">
                                    <strong>Kelas:</strong> ${booking.class}<br>
                                    <strong>Guru:</strong> ${booking.teacher}
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-3 bg-purple-50 border border-purple-200 rounded-lg">
                            <div class="text-sm">
                                <div class="font-semibold text-purple-900 mb-2">ðŸ”¬ Materi</div>
                                <div class="text-purple-800">${booking.subject}</div>
                                ${booking.notes ? `<div class="mt-2 text-purple-700"><strong>Catatan:</strong> ${booking.notes}</div>` : ''}
                            </div>
                        </div>
                        
                        <div class="p-3 bg-gray-50 border border-gray-200 rounded-lg">
                            <div class="text-xs text-gray-600">
                                <strong>Dibooking oleh:</strong> ${booking.bookedBy}<br>
                                <strong>Waktu booking:</strong> ${new Date(booking.bookedAt).toLocaleString('id-ID')}
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button onclick="this.closest('.fixed').remove()" 
                                class="flex-1 bg-gray-200 text-gray-700 py-2 px-4 rounded-lg font-medium hover:bg-gray-300 transition-colors">
                            Tutup
                        </button>
                        <button onclick="cancelBooking('${booking.id}'); this.closest('.fixed').remove()" 
                                class="flex-1 bg-red-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-red-700 transition-colors">
                            Batalkan Booking
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function cancelBooking(bookingId) {
            // Find and remove booking
            const bookingIndex = bookings.findIndex(b => b.id === bookingId);
            if (bookingIndex !== -1) {
                const booking = bookings[bookingIndex];
                bookings.splice(bookingIndex, 1);
                
                // Update schedule display
                generateScheduleGrid();
                
                // Show success message
                const dayNames = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat'];
                const slot = timeSlots[booking.slotIndex];
                
                showMessage(`Booking berhasil dibatalkan!\n\nKelas: ${booking.class}\nWaktu: ${dayNames[booking.day]}, ${slot.start}-${slot.end}\n\nSlot sekarang tersedia untuk booking lain.`, 'success');
            }
        }

        function showMessage(message, type = 'info') {
            // Create a simple toast message
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 p-4 rounded-lg text-white z-50 ${
                type === 'success' ? 'bg-green-500' : 
                type === 'warning' ? 'bg-orange-500' : 
                type === 'error' ? 'bg-red-500' : 'bg-blue-500'
            }`;
            toast.style.whiteSpace = 'pre-line';
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 4000);
        }

        function generateSampleBookings() {
            // Add some sample bookings for demonstration
            const sampleBookings = [
                { 
                    id: 'sample1',
                    day: 0, 
                    slotIndex: 2, 
                    weekOffset: 0, 
                    class: 'VII A', 
                    teacher: 'Siti Anidah P., S.Pd (3)', 
                    subject: 'Pengamatan sel tumbuhan dengan mikroskop',
                    notes: 'Persiapkan preparat basah',
                    bookedBy: 'Admin System',
                    bookedAt: new Date(Date.now() - 86400000).toISOString() // 1 day ago
                },
                { 
                    id: 'sample2',
                    day: 1, 
                    slotIndex: 4, 
                    weekOffset: 0, 
                    class: 'VIII B', 
                    teacher: 'Nurhayati Ningsih, S.Pd (7)', 
                    subject: 'Praktikum reaksi kimia sederhana',
                    notes: 'Siapkan larutan HCl dan NaOH',
                    bookedBy: 'Admin System',
                    bookedAt: new Date(Date.now() - 172800000).toISOString() // 2 days ago
                },
                { 
                    id: 'sample3',
                    day: 2, 
                    slotIndex: 1, 
                    weekOffset: 0, 
                    class: 'IX C', 
                    teacher: 'Suci Alima, S.Si, M.Pd (22)', 
                    subject: 'Analisis larutan asam basa',
                    notes: 'Gunakan indikator universal',
                    bookedBy: 'Admin System',
                    bookedAt: new Date(Date.now() - 259200000).toISOString() // 3 days ago
                },
                { 
                    id: 'sample4',
                    day: 3, 
                    slotIndex: 6, 
                    weekOffset: 0, 
                    class: 'VII D', 
                    teacher: 'Wiwin Andarie, S.Pd, M.Psi (16)', 
                    subject: 'Pengamatan struktur batang tumbuhan',
                    notes: 'Bawa sampel batang dikotil dan monokotil',
                    bookedBy: 'Admin System',
                    bookedAt: new Date(Date.now() - 345600000).toISOString() // 4 days ago
                },
                { 
                    id: 'sample5',
                    day: 4, 
                    slotIndex: 3, 
                    weekOffset: 0, 
                    class: 'VIII E', 
                    teacher: 'Mahmud S.Pd (39)', 
                    subject: 'Praktikum fotosintesis',
                    notes: 'Siapkan tanaman Hydrilla dan lampu',
                    bookedBy: 'Admin System',
                    bookedAt: new Date(Date.now() - 432000000).toISOString() // 5 days ago
                }
            ];
            
            bookings.push(...sampleBookings);
        }

        // Inventory functions
        function showInventoryPage() {
            hideAllForms();
            document.getElementById('inventoryPage').classList.remove('hidden');
            document.getElementById('inventoryPage').classList.add('slide-in');
            
            // Expand container for inventory view
            const mainContainer = document.getElementById('mainContainer');
            mainContainer.classList.remove('max-w-md');
            mainContainer.classList.add('max-w-4xl');
            
            // Load inventory data if not already loaded
            if (inventoryData.length === 0) {
                loadInventoryData();
            } else {
                displayInventoryData();
            }
        }

        function showAddItemForm() {
            document.getElementById('addItemForm').classList.remove('hidden');
            document.getElementById('addItemForm').classList.add('slide-in');
            
            // Scroll to form
            document.getElementById('addItemForm').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function hideAddItemForm() {
            document.getElementById('addItemForm').classList.add('hidden');
            document.getElementById('addItemForm').classList.remove('slide-in');
            
            // Reset form
            document.getElementById('addItemForm').querySelector('form').reset();
        }

        async function handleAddItem(event) {
            event.preventDefault();
            
            const name = document.getElementById('newItemName').value.trim();
            const category = document.getElementById('newItemCategory').value;
            const quantity = parseInt(document.getElementById('newItemQuantity').value);
            const unit = document.getElementById('newItemUnit').value;
            const condition = document.getElementById('newItemCondition').value;
            const description = document.getElementById('newItemDescription').value.trim();
            const addBtn = document.getElementById('addItemBtn');
            
            // Show loading state
            addBtn.textContent = 'Menambahkan...';
            addBtn.disabled = true;
            
            try {
                // Generate new item number
                const maxNo = Math.max(...inventoryData.map(item => item.no));
                const newNo = maxNo + 1;
                
                // Create new inventory item
                const newItem = {
                    no: newNo,
                    nama: name,
                    kategori: category,
                    jumlah: quantity,
                    kondisi: condition,
                    satuan: unit,
                    keterangan: description
                };
                
                // Add to inventory data
                inventoryData.push(newItem);
                
                // Simulate saving delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Update display
                displayInventoryData();
                
                // Show success message
                showMessage(`Alat "${name}" berhasil ditambahkan ke inventaris dengan nomor #${newNo.toString().padStart(3, '0')}!`, 'success');
                
                // Hide form and reset
                hideAddItemForm();
                
            } catch (error) {
                showMessage('Gagal menambahkan alat. Silakan coba lagi.', 'error');
            } finally {
                addBtn.textContent = 'Tambah Alat';
                addBtn.disabled = false;
            }
        }

        function loadInventoryData() {
            // Show loading state
            document.getElementById('inventoryLoading').classList.remove('hidden');
            document.getElementById('inventoryList').innerHTML = '';
            
            // Simulate loading delay
            setTimeout(() => {
                // Complete inventory data from the provided list
                inventoryData = [
                    { no: 1, nama: "Bola Dunia", kategori: "Model", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Globe untuk pembelajaran geografi" },
                    { no: 2, nama: "Tata Surya", kategori: "Model", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Model sistem tata surya" },
                    { no: 3, nama: "Respirometer", kategori: "Biologi", jumlah: 14, kondisi: "baik", satuan: "Set", keterangan: "13 baik, 1 kurang baik" },
                    { no: 4, nama: "Kotak Genetika", kategori: "Biologi", jumlah: 5, kondisi: "baik", satuan: "Buah", keterangan: "2 warna box kayu" },
                    { no: 5, nama: "Kotak Genetika", kategori: "Biologi", jumlah: 5, kondisi: "baik", satuan: "Buah", keterangan: "2 warna box plastik" },
                    { no: 6, nama: "Kotak Genetika", kategori: "Biologi", jumlah: 8, kondisi: "baik", satuan: "Buah", keterangan: "5 warna box plastik" },
                    { no: 7, nama: "Model Otak", kategori: "Model", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Model anatomi otak manusia" },
                    { no: 8, nama: "Model Mata", kategori: "Model", jumlah: 5, kondisi: "baik", satuan: "Buah", keterangan: "Model anatomi mata manusia" },
                    { no: 9, nama: "Model Telinga", kategori: "Model", jumlah: 5, kondisi: "baik", satuan: "Buah", keterangan: "Model anatomi telinga manusia" },
                    { no: 10, nama: "Torso Wanita", kategori: "Model", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Model torso anatomi wanita" },
                    { no: 11, nama: "Torso Pria", kategori: "Model", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Model torso anatomi pria" },
                    { no: 12, nama: "Model Jantung", kategori: "Model", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Model anatomi jantung manusia" },
                    { no: 13, nama: "Model Kulit", kategori: "Model", jumlah: 3, kondisi: "baik", satuan: "Buah", keterangan: "Model anatomi kulit manusia" },
                    { no: 14, nama: "Model Ginjal", kategori: "Model", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Model anatomi ginjal manusia" },
                    { no: 15, nama: "Model Rangka", kategori: "Model", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Model rangka manusia" },
                    { no: 16, nama: "Mikroskop", kategori: "Mikroskop", jumlah: 38, kondisi: "baik", satuan: "Buah", keterangan: "Mikroskop Monokuler U/lnjt" },
                    { no: 17, nama: "Mikroskop", kategori: "Mikroskop", jumlah: 7, kondisi: "kurang", satuan: "Buah", keterangan: "Mikroskop Monokuler U/lnjt" },
                    { no: 18, nama: "Mikroskop", kategori: "Mikroskop", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Monokuler listrik" },
                    { no: 19, nama: "Mikroskop", kategori: "Mikroskop", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Mikroskop Binokuler listrik" },
                    { no: 20, nama: "Mikroskop Stereo", kategori: "Mikroskop", jumlah: 1, kondisi: "baik", satuan: "Pack", keterangan: "Mikroskop stereo untuk observasi" },
                    { no: 21, nama: "Perangkat Perawatan Mikro", kategori: "Mikroskop", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Kit perawatan mikroskop" },
                    { no: 22, nama: "Kaca Benda", kategori: "Mikroskop", jumlah: 4, kondisi: "baik", satuan: "Pack", keterangan: "Object glass untuk preparat" },
                    { no: 23, nama: "Kaca Penutup", kategori: "Mikroskop", jumlah: 7, kondisi: "baik", satuan: "Pack", keterangan: "Cover glass untuk preparat" },
                    { no: 24, nama: "Lup", kategori: "Optik", jumlah: 4, kondisi: "baik", satuan: "Pack", keterangan: "Kaca pembesar untuk observasi" },
                    { no: 25, nama: "Panci Bedah", kategori: "Medis", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Ukuran 20 x 20 cmÂ²" },
                    { no: 26, nama: "Panci Bedah", kategori: "Medis", jumlah: 3, kondisi: "baik", satuan: "Buah", keterangan: "Ukuran 26 x 30 cmÂ²" },
                    { no: 27, nama: "Papan Bedah", kategori: "Medis", jumlah: 8, kondisi: "baik", satuan: "Buah", keterangan: "Papan untuk praktikum bedah" },
                    { no: 28, nama: "Alat Bedah", kategori: "Medis", jumlah: 12, kondisi: "baik", satuan: "Buah", keterangan: "Set alat bedah lengkap" },
                    { no: 29, nama: "Alat Bedah", kategori: "Medis", jumlah: 3, kondisi: "baik", satuan: "Buah", keterangan: "Box kulit" },
                    { no: 30, nama: "Alat Bedah", kategori: "Medis", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Box kayu" },
                    { no: 31, nama: "Stetoscope", kategori: "Medis", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Stetoskop tipe 1" },
                    { no: 32, nama: "Stetoscope", kategori: "Medis", jumlah: 3, kondisi: "baik", satuan: "Buah", keterangan: "Stetoskop tipe 2" },
                    { no: 33, nama: "Stetoscope", kategori: "Medis", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Stetoskop tipe 3" },
                    { no: 34, nama: "Spygmomanometer", kategori: "Medis", jumlah: 5, kondisi: "baik", satuan: "Buah", keterangan: "Tensimeter manual" },
                    { no: 35, nama: "Tensimeter Digital", kategori: "Medis", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Tensimeter digital otomatis" },
                    { no: 36, nama: "Auksanometer", kategori: "Biologi", jumlah: 2, kondisi: "baik", satuan: "Set", keterangan: "Alat ukur pertumbuhan tanaman" },
                    { no: 37, nama: "Kuadrat", kategori: "Biologi", jumlah: 4, kondisi: "baik", satuan: "Buah", keterangan: "Frame kuadrat untuk sampling" },
                    { no: 38, nama: "Aquarium", kategori: "Biologi", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Besar kaca persegi" },
                    { no: 39, nama: "Aquarium", kategori: "Biologi", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Kaca bulat" },
                    { no: 40, nama: "Aquarium", kategori: "Biologi", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Kecil kaca persegi" },
                    { no: 41, nama: "Insektarium", kategori: "Biologi", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Kandang untuk serangga" },
                    { no: 42, nama: "Kartu Nutrisi", kategori: "Biologi", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Kartu informasi nutrisi" },
                    { no: 42, nama: "Kit Elektrostatik", kategori: "Fisika", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Kit percobaan elektrostatik" },
                    { no: 43, nama: "Garpu Tala", kategori: "Fisika", jumlah: 5, kondisi: "baik", satuan: "Set", keterangan: "Garpu tala berbagai frekuensi" },
                    { no: 44, nama: "Slinki", kategori: "Fisika", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Slinki untuk gelombang" },
                    { no: 45, nama: "Slinki", kategori: "Fisika", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Slinki cadangan" },
                    { no: 46, nama: "Kit Listrik", kategori: "Fisika", jumlah: 1, kondisi: "baik", satuan: "Set", keterangan: "Kit percobaan listrik dasar" },
                    { no: 47, nama: "Kit Listrik & Magnet", kategori: "Fisika", jumlah: 14, kondisi: "baik", satuan: "Set", keterangan: "Kit percobaan listrik dan magnet" },
                    { no: 48, nama: "Magnet Batang", kategori: "Fisika", jumlah: 2, kondisi: "baik", satuan: "Pasang", keterangan: "Magnet batang permanen" },
                    { no: 49, nama: "Magnet U", kategori: "Fisika", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Magnet bentuk U" },
                    { no: 50, nama: "Beban Bercelah & Penggantung", kategori: "Fisika", jumlah: 1, kondisi: "baik", satuan: "Set", keterangan: "Set beban untuk mekanika" },
                    { no: 51, nama: "Beban Bercelah", kategori: "Fisika", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Beban bercelah 50g" },
                    { no: 52, nama: "Beban Berkait", kategori: "Fisika", jumlah: 6, kondisi: "baik", satuan: "Buah", keterangan: "10 gr" },
                    { no: 53, nama: "Beban Berkait", kategori: "Fisika", jumlah: 6, kondisi: "baik", satuan: "Buah", keterangan: "20 gr" },
                    { no: 54, nama: "Beban Berkait", kategori: "Fisika", jumlah: 5, kondisi: "baik", satuan: "Buah", keterangan: "30 gr" },
                    { no: 55, nama: "Beban Berkait", kategori: "Fisika", jumlah: 5, kondisi: "baik", satuan: "Buah", keterangan: "50 gr" },
                    { no: 56, nama: "Beban Berkait", kategori: "Fisika", jumlah: 6, kondisi: "baik", satuan: "Buah", keterangan: "100 gr" },
                    { no: 57, nama: "Katrol 1 Roda", kategori: "Fisika", jumlah: 4, kondisi: "baik", satuan: "Buah", keterangan: "Katrol tunggal" },
                    { no: 58, nama: "Katrol 2 Roda", kategori: "Fisika", jumlah: 5, kondisi: "baik", satuan: "Buah", keterangan: "Katrol ganda" },
                    { no: 59, nama: "Kit Mekanika", kategori: "Fisika", jumlah: 15, kondisi: "baik", satuan: "Set", keterangan: "Kit percobaan mekanika" },
                    { no: 60, nama: "Kit Hidrostatika & Panas", kategori: "Fisika", jumlah: 14, kondisi: "baik", satuan: "Set", keterangan: "Kit percobaan hidrostatika dan panas" },
                    { no: 61, nama: "Cermin Datar Lipat", kategori: "Optik", jumlah: 5, kondisi: "baik", satuan: "Buah", keterangan: "Cermin datar yang dapat dilipat" },
                    { no: 62, nama: "Kit Optik", kategori: "Optik", jumlah: 13, kondisi: "baik", satuan: "Set", keterangan: "Kit percobaan optik lengkap" },
                    { no: 63, nama: "Cermin Datar", kategori: "Optik", jumlah: 8, kondisi: "baik", satuan: "Buah", keterangan: "Cermin datar standar" },
                    { no: 64, nama: "Prisma", kategori: "Optik", jumlah: 6, kondisi: "baik", satuan: "Buah", keterangan: "Prisma segitiga kaca" },
                    { no: 65, nama: "Lensa Bikonveks", kategori: "Optik", jumlah: 10, kondisi: "baik", satuan: "Buah", keterangan: "9 baik, 1 kurang baik" },
                    { no: 66, nama: "Lensa Bikonveks", kategori: "Optik", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Ketebalan sedang" },
                    { no: 67, nama: "Lensa Bikonveks", kategori: "Optik", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Tebal" },
                    { no: 68, nama: "Lensa Bikonkaf", kategori: "Optik", jumlah: 3, kondisi: "baik", satuan: "Buah", keterangan: "Lensa bikonkaf (cekung)" },
                    { no: 68, nama: "Pompa Pascal", kategori: "Fisika", jumlah: 7, kondisi: "baik", satuan: "Buah", keterangan: "6 baik, 1 kurang baik" },
                    { no: 69, nama: "Pompa Isap", kategori: "Fisika", jumlah: 3, kondisi: "baik", satuan: "Buah", keterangan: "Pompa isap manual" },
                    { no: 70, nama: "Pompa Tekan", kategori: "Fisika", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Pompa tekan manual" },
                    { no: 71, nama: "Bejana Berhubungan", kategori: "Fisika", jumlah: 8, kondisi: "baik", satuan: "Buah", keterangan: "Bejana untuk hukum Pascal" },
                    { no: 72, nama: "Bejana Kapiler", kategori: "Fisika", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Bejana untuk kapilaritas" },
                    { no: 73, nama: "Alat Hukum Boyle", kategori: "Fisika", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Alat percobaan hukum Boyle" },
                    { no: 74, nama: "Manometer Terbuka", kategori: "Fisika", jumlah: 8, kondisi: "baik", satuan: "Buah", keterangan: "Manometer untuk tekanan" },
                    { no: 75, nama: "Pipa Y", kategori: "Fisika", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Pipa berbentuk Y" },
                    { no: 76, nama: "Ohmeter", kategori: "Elektronik", jumlah: 4, kondisi: "baik", satuan: "Buah", keterangan: "Alat ukur hambatan" },
                    { no: 77, nama: "Amperemeter", kategori: "Elektronik", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Alat ukur arus listrik" },
                    { no: 78, nama: "Basicmeter", kategori: "Elektronik", jumlah: 8, kondisi: "baik", satuan: "Buah", keterangan: "7 baik, 1 kurang baik" },
                    { no: 79, nama: "Shunt", kategori: "Elektronik", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Shunt untuk amperemeter" },
                    { no: 80, nama: "Multitester", kategori: "Elektronik", jumlah: 4, kondisi: "baik", satuan: "Buah", keterangan: "Multimeter digital" },
                    { no: 81, nama: "Catu Daya/Power Supply", kategori: "Elektronik", jumlah: 4, kondisi: "baik", satuan: "Buah", keterangan: "Power supply variabel" },
                    { no: 82, nama: "Kotak Baterai", kategori: "Elektronik", jumlah: 8, kondisi: "baik", satuan: "Buah", keterangan: "Kotak baterai untuk percobaan" },
                    { no: 83, nama: "Batang Pengaduk", kategori: "Kimia", jumlah: 59, kondisi: "baik", satuan: "Buah", keterangan: "Batang pengaduk kaca" },
                    { no: 84, nama: "Bunsen Besar", kategori: "Kimia", jumlah: 8, kondisi: "baik", satuan: "Buah", keterangan: "Pembakar bunsen ukuran besar" },
                    { no: 85, nama: "Bunsen Kecil", kategori: "Kimia", jumlah: 17, kondisi: "baik", satuan: "Buah", keterangan: "Pembakar bunsen ukuran kecil" },
                    { no: 86, nama: "Cawan Petri", kategori: "Glassware", jumlah: 44, kondisi: "baik", satuan: "Buah", keterangan: "Cawan petri untuk kultur" },
                    { no: 87, nama: "Corong", kategori: "Glassware", jumlah: 3, kondisi: "baik", satuan: "Buah", keterangan: "Kaca Ã˜ 16-50 mm" },
                    { no: 88, nama: "Corong", kategori: "Glassware", jumlah: 14, kondisi: "baik", satuan: "Buah", keterangan: "Kaca Ã˜ 16-75 mm" },
                    { no: 89, nama: "Corong", kategori: "Glassware", jumlah: 6, kondisi: "baik", satuan: "Buah", keterangan: "Corong plastik" },
                    { no: 90, nama: "Gelas Kimia", kategori: "Glassware", jumlah: 8, kondisi: "baik", satuan: "Buah", keterangan: "Ukuran 100 ml" },
                    { no: 91, nama: "Gelas Kimia", kategori: "Glassware", jumlah: 15, kondisi: "baik", satuan: "Buah", keterangan: "Ukuran 250 ml" },
                    { no: 92, nama: "Gelas Kimia", kategori: "Glassware", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Ukuran 250 ml" },
                    { no: 93, nama: "Gelas Kimia", kategori: "Glassware", jumlah: 18, kondisi: "baik", satuan: "Buah", keterangan: "Ukuran 300 ml" },
                    { no: 94, nama: "Gelas Kimia", kategori: "Glassware", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Ukuran 500 ml" },
                    { no: 95, nama: "Gelas Kimia", kategori: "Glassware", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Ukuran 500 ml" },
                    { no: 96, nama: "Gelas Kimia", kategori: "Glassware", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Ukuran 500 ml" },
                    { no: 97, nama: "Gelas Kimia", kategori: "Glassware", jumlah: 3, kondisi: "baik", satuan: "Buah", keterangan: "Ukuran 600 ml" },
                    { no: 98, nama: "Gelas Kimia", kategori: "Glassware", jumlah: 3, kondisi: "baik", satuan: "Buah", keterangan: "Ukuran 600 ml" },
                    { no: 99, nama: "Gelas Kimia", kategori: "Glassware", jumlah: 3, kondisi: "baik", satuan: "Buah", keterangan: "Ukuran 100 ml" },
                    { no: 100, nama: "Kaki Tiga", kategori: "Kimia", jumlah: 38, kondisi: "baik", satuan: "Buah", keterangan: "Kaki tiga untuk pemanas" },
                    { no: 101, nama: "Asbes", kategori: "Kimia", jumlah: 25, kondisi: "baik", satuan: "Buah", keterangan: "15 baik, 10 kurang baik" },
                    { no: 102, nama: "Kasa", kategori: "Kimia", jumlah: 11, kondisi: "baik", satuan: "Pack", keterangan: "Kasa untuk pemanas bunsen" },
                    { no: 103, nama: "Stopwatch Air", kategori: "Fisika", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Stopwatch tahan air" },
                    { no: 104, nama: "Stopwatch Biasa", kategori: "Fisika", jumlah: 8, kondisi: "baik", satuan: "Buah", keterangan: "Stopwatch analog standar" },
                    { no: 105, nama: "Labu Erlenmeyer", kategori: "Glassware", jumlah: 4, kondisi: "baik", satuan: "Buah", keterangan: "Ukuran 200 ml" },
                    { no: 106, nama: "Labu Erlenmeyer", kategori: "Glassware", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Ukuran 500 ml" },
                    { no: 107, nama: "Labu Erlenmeyer", kategori: "Glassware", jumlah: 6, kondisi: "baik", satuan: "Buah", keterangan: "Ukuran 1000 ml" },
                    { no: 108, nama: "Botol Labu Didih", kategori: "Glassware", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Besar" },
                    { no: 109, nama: "Botol Labu Didih", kategori: "Glassware", jumlah: 5, kondisi: "baik", satuan: "Buah", keterangan: "Kecil" },
                    { no: 110, nama: "Alu + Mortar", kategori: "Kimia", jumlah: 22, kondisi: "baik", satuan: "Buah", keterangan: "Kecil" },
                    { no: 111, nama: "Alu + Mortar", kategori: "Kimia", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Besar" },
                    { no: 112, nama: "Model Molekul", kategori: "Model", jumlah: 10, kondisi: "baik", satuan: "Buah", keterangan: "Model molekul organik" },
                    { no: 113, nama: "Neraca 311", kategori: "Kimia", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Neraca analitik presisi tinggi" },
                    { no: 114, nama: "Neraca O-Haouse", kategori: "Kimia", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Neraca mekanik O-Haouse" },
                    { no: 115, nama: "Jangka Sorong", kategori: "Fisika", jumlah: 8, kondisi: "baik", satuan: "Buah", keterangan: "Jangka sorong digital" },
                    { no: 116, nama: "Perkakas Elektronika", kategori: "Elektronik", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Set perkakas elektronika" },
                    { no: 117, nama: "Mikrometer", kategori: "Fisika", jumlah: 9, kondisi: "baik", satuan: "Buah", keterangan: "Mikrometer sekrup presisi" },
                    { no: 118, nama: "Plat Tetes Kecil", kategori: "Glassware", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Plat tetes porselen kecil" },
                    { no: 119, nama: "Plat Tetes Besar", kategori: "Glassware", jumlah: 8, kondisi: "baik", satuan: "Buah", keterangan: "Plat tetes porselen besar" },
                    { no: 120, nama: "Pipa Kaca", kategori: "Glassware", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Pipa kaca untuk percobaan" },
                    { no: 121, nama: "Pipet Tetes", kategori: "Glassware", jumlah: 322, kondisi: "baik", satuan: "Buah", keterangan: "295 baik, 27 kurang baik" },
                    { no: 122, nama: "Sikat Tabung Reaksi", kategori: "Kimia", jumlah: 34, kondisi: "baik", satuan: "Buah", keterangan: "Sikat pembersih tabung reaksi" },
                    { no: 123, nama: "Silinder Ukur", kategori: "Glassware", jumlah: 7, kondisi: "baik", satuan: "Buah", keterangan: "Ukuran 25 ml" },
                    { no: 124, nama: "Silinder Ukur", kategori: "Glassware", jumlah: 6, kondisi: "baik", satuan: "Buah", keterangan: "Ukuran 25 ml" },
                    { no: 125, nama: "Silinder Ukur", kategori: "Glassware", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Ukuran 50 ml" },
                    { no: 126, nama: "Silinder Ukur", kategori: "Glassware", jumlah: 4, kondisi: "baik", satuan: "Buah", keterangan: "Ukuran 50 ml" },
                    { no: 127, nama: "Silinder Ukur", kategori: "Glassware", jumlah: 6, kondisi: "baik", satuan: "Buah", keterangan: "Ukuran 250 ml" },
                    { no: 128, nama: "Silinder Ukur", kategori: "Glassware", jumlah: 4, kondisi: "baik", satuan: "Buah", keterangan: "Ukuran 250 ml" },
                    { no: 129, nama: "Silinder Ukur", kategori: "Glassware", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Ukuran 250 ml" },
                    { no: 130, nama: "Statif, Bentuk A", kategori: "Kimia", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Statif bentuk A untuk penjepit" },
                    { no: 131, nama: "Batang Statif", kategori: "Kimia", jumlah: 8, kondisi: "baik", satuan: "Buah", keterangan: "Batang statif logam" },
                    { no: 132, nama: "Klem Universal", kategori: "Kimia", jumlah: 17, kondisi: "baik", satuan: "Buah", keterangan: "Klem universal untuk statif" },
                    { no: 133, nama: "Klem Boss Head", kategori: "Kimia", jumlah: 12, kondisi: "baik", satuan: "Buah", keterangan: "Boss head untuk klem" },
                    { no: 134, nama: "Tabung Reaksi", kategori: "Glassware", jumlah: 3, kondisi: "baik", satuan: "Buah", keterangan: "Besar" },
                    { no: 135, nama: "Tabung Reaksi", kategori: "Glassware", jumlah: 267, kondisi: "baik", satuan: "Buah", keterangan: "Sedang" },
                    { no: 136, nama: "Tabung Reaksi", kategori: "Glassware", jumlah: 50, kondisi: "baik", satuan: "Buah", keterangan: "Kecil" },
                    { no: 137, nama: "Penjepit Tabung Reaksi", kategori: "Kimia", jumlah: 15, kondisi: "baik", satuan: "Buah", keterangan: "Penjepit kayu untuk tabung reaksi" },
                    { no: 138, nama: "Rak Tabung Reaksi", kategori: "Kimia", jumlah: 37, kondisi: "baik", satuan: "Buah", keterangan: "Rak kayu untuk tabung reaksi" },
                    { no: 139, nama: "Termometer Klinis", kategori: "Medis", jumlah: 16, kondisi: "baik", satuan: "Buah", keterangan: "Termometer klinis digital" },
                    { no: 140, nama: "Termometer Klinis", kategori: "Medis", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Termometer klinis raksa" },
                    { no: 141, nama: "Termometer Raksa", kategori: "Fisika", jumlah: 4, kondisi: "baik", satuan: "Buah", keterangan: "Termometer raksa laboratorium" },
                    { no: 142, nama: "Termometer Alkohol", kategori: "Fisika", jumlah: 5, kondisi: "baik", satuan: "Buah", keterangan: "Termometer alkohol berwarna" },
                    { no: 143, nama: "Termometer Dinding", kategori: "Fisika", jumlah: 1, kondisi: "kurang", satuan: "Buah", keterangan: "Termometer dinding ruangan" },
                    { no: 144, nama: "Keranjang Serangga", kategori: "Biologi", jumlah: 4, kondisi: "baik", satuan: "Buah", keterangan: "Keranjang untuk koleksi serangga" },
                    { no: 145, nama: "Insectnet", kategori: "Biologi", jumlah: 5, kondisi: "baik", satuan: "Set", keterangan: "Jaring penangkap serangga" },
                    { no: 146, nama: "pH Meter", kategori: "Kimia", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "pH meter digital" },
                    { no: 147, nama: "Teleskop", kategori: "Fisika", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Teleskop refraktor" },
                    { no: 148, nama: "Carta Kelahiran", kategori: "Model", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Poster proses kelahiran" },
                    { no: 149, nama: "Poster Perkembangbiakan Tumb. Vegetatif", kategori: "Model", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Poster reproduksi vegetatif tumbuhan" },
                    { no: 150, nama: "Poster Perkembangbiakan Tumb. Generatif", kategori: "Model", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Poster reproduksi generatif tumbuhan" },
                    { no: 151, nama: "Carta DNA/RNA", kategori: "Model", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Poster struktur DNA dan RNA" },
                    { no: 152, nama: "Poster Susunan Otot", kategori: "Model", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Poster anatomi otot manusia" },
                    { no: 153, nama: "Carta Hukum Mendel", kategori: "Model", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Poster hukum pewarisan Mendel" },
                    { no: 154, nama: "Carta Sel", kategori: "Model", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Poster struktur sel" },
                    { no: 155, nama: "Carta Sistem Reproduksi Manusia", kategori: "Model", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Poster sistem reproduksi manusia" },
                    { no: 156, nama: "Carta Metamorfosis", kategori: "Model", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Poster metamorfosis hewan" },
                    { no: 157, nama: "Carta Pertumbuhan dan Perkembangan Manusia", kategori: "Model", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Poster pertumbuhan manusia" },
                    { no: 158, nama: "pH Meter", kategori: "Kimia", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "pH meter cadangan" },
                    { no: 159, nama: "Carta Reproduksi Tumbuhan Generatif", kategori: "Model", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Poster reproduksi generatif tumbuhan" },
                    { no: 160, nama: "Carta Reproduksi Tumbuhan Vegetatif", kategori: "Model", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Poster reproduksi vegetatif tumbuhan" },
                    { no: 161, nama: "Carta Reproduksi Hewan Tinggi (Generatif)", kategori: "Model", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Poster reproduksi hewan tinggi" },
                    { no: 162, nama: "Carta Siklus Hidup Tumbuhan Paku dan Lumut", kategori: "Model", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Poster siklus hidup tumbuhan paku dan lumut" },
                    { no: 163, nama: "Carta Macam-macam Penyerbukan", kategori: "Model", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Poster jenis-jenis penyerbukan" },
                    { no: 164, nama: "Carta Macam-macam Bunga", kategori: "Model", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Poster jenis-jenis bunga" },
                    { no: 165, nama: "Carta Sistem Peredaran Darah Manusia", kategori: "Model", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Poster sistem peredaran darah" },
                    { no: 166, nama: "Carta Sistem Pencernaan Manusia", kategori: "Model", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Poster sistem pencernaan" },
                    { no: 167, nama: "Carta Sistem Ereksi Manusia", kategori: "Model", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Poster sistem ekskresi manusia" },
                    { no: 168, nama: "Carta Interaksi Makhluk Hidup", kategori: "Model", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Poster interaksi ekosistem" },
                    { no: 169, nama: "Carta Sistem Pernapasan Manusia", kategori: "Model", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Poster sistem pernapasan" },
                    { no: 170, nama: "Carta Jaringan pada Tumbuhan", kategori: "Model", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Poster jaringan tumbuhan" },
                    { no: 171, nama: "Carta Otot Tubuh Manusia", kategori: "Model", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Poster otot tubuh manusia" },
                    { no: 172, nama: "Carta Struktur Tulang dan Sendi", kategori: "Model", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Poster struktur tulang dan sendi" },
                    { no: 173, nama: "Carta Penyakit dan Kelainan Tulang", kategori: "Model", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Poster penyakit tulang" },
                    { no: 174, nama: "Carta Sistem Saraf Manusia", kategori: "Model", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Poster sistem saraf" },
                    { no: 175, nama: "Carta Alat Indra Manusia", kategori: "Model", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Poster alat indra manusia" },
                    { no: 176, nama: "Carta Organisasi Kehidupan", kategori: "Model", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Poster organisasi kehidupan" },
                    { no: 177, nama: "Carta Zat Psikotropika", kategori: "Model", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Poster bahaya narkoba" },
                    { no: 178, nama: "Carta Perubahan dan Aliran Energi", kategori: "Model", jumlah: 2, kondisi: "baik", satuan: "Buah", keterangan: "Poster aliran energi ekosistem" },
                    { no: 179, nama: "Alat Peraga Sistem Peredaran Darah", kategori: "Model", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Model 3D sistem peredaran darah" },
                    { no: 180, nama: "Alat Peraga Sistem Pencernaan", kategori: "Model", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Model 3D sistem pencernaan" },
                    { no: 181, nama: "Alat Peraga Sistem Pernapasan", kategori: "Model", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Model 3D sistem pernapasan" },
                    { no: 182, nama: "Alat Peraga Susunan Syaraf", kategori: "Model", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Model 3D sistem saraf" },
                    { no: 183, nama: "Alat Peraga Anatomi Panggul dan Janin", kategori: "Model", jumlah: 1, kondisi: "baik", satuan: "Buah", keterangan: "Model 3D anatomi panggul dan janin" }
                ];
                
                displayInventoryData();
            }, 1000);
        }

        function displayInventoryData() {
            document.getElementById('inventoryLoading').classList.add('hidden');
            filterInventory();
            updateInventoryStats();
        }

        function filterInventory() {
            const searchTerm = document.getElementById('inventorySearch').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            
            filteredInventoryData = inventoryData.filter(item => {
                const matchesSearch = item.nama.toLowerCase().includes(searchTerm) || 
                                    item.keterangan.toLowerCase().includes(searchTerm) ||
                                    item.no.toString().padStart(3, '0').includes(searchTerm);
                const matchesCategory = !categoryFilter || item.kategori === categoryFilter;
                const matchesStatus = currentStatusFilter === 'all' || item.kondisi === currentStatusFilter;
                
                return matchesSearch && matchesCategory && matchesStatus;
            });
            
            renderInventoryList();
        }

        function filterByStatus(status) {
            currentStatusFilter = status;
            
            // Update button states
            const buttons = ['filterAll', 'filterBaik', 'filterKurang', 'filterRusak'];
            buttons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                btn.classList.remove('bg-gray-600', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
            });
            
            const activeBtn = document.getElementById(`filter${status.charAt(0).toUpperCase() + status.slice(1)}`);
            if (activeBtn) {
                activeBtn.classList.remove('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                activeBtn.classList.add('bg-gray-600', 'text-white');
            }
            
            filterInventory();
        }

        function renderInventoryList() {
            const container = document.getElementById('inventoryList');
            
            if (filteredInventoryData.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <svg class="w-12 h-12 mx-auto mb-3 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2 2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-2.172a1 1 0 01-.707-.293l-2.414-2.414a1 1 0 00-.707-.293H8"></path>
                        </svg>
                        <p class="text-sm">Tidak ada data inventaris yang sesuai dengan filter</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filteredInventoryData.map(item => {
                const conditionColor = {
                    'baik': 'bg-green-100 text-green-800 border-green-200',
                    'kurang': 'bg-orange-100 text-orange-800 border-orange-200',
                    'rusak': 'bg-red-100 text-red-800 border-red-200'
                };
                
                const conditionText = {
                    'baik': 'Baik',
                    'kurang': 'Kurang Baik',
                    'rusak': 'Rusak'
                };
                
                return `
                    <div class="bg-white border border-gray-200 rounded-lg p-3 hover:shadow-md transition-shadow">
                        <div class="flex items-start justify-between mb-2">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                                    <span class="text-xs font-bold text-green-800">#${item.no.toString().padStart(3, '0')}</span>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-900 text-sm">${item.nama}</h3>
                                    <p class="text-xs text-gray-600">${item.kategori}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm font-semibold text-gray-900">${item.jumlah} ${item.satuan}</div>
                                <span class="inline-block px-2 py-1 text-xs font-medium rounded-full border ${conditionColor[item.kondisi]}">
                                    ${conditionText[item.kondisi]}
                                </span>
                            </div>
                        </div>
                        <p class="text-xs text-gray-600 bg-gray-50 p-2 rounded">${item.keterangan}</p>
                    </div>
                `;
            }).join('');
        }

        function updateInventoryStats() {
            const total = inventoryData.length;
            const good = inventoryData.filter(item => item.kondisi === 'baik').length;
            const poor = inventoryData.filter(item => item.kondisi === 'kurang').length;
            const damaged = inventoryData.filter(item => item.kondisi === 'rusak').length;
            
            document.getElementById('totalItems').textContent = total;
            document.getElementById('goodItems').textContent = good;
            document.getElementById('poorItems').textContent = poor;
            document.getElementById('damagedItems').textContent = damaged;
        }

        // Incident form functions
        function showIncidentForm() {
            hideAllForms();
            document.getElementById('incidentFormPage').classList.remove('hidden');
            document.getElementById('incidentFormPage').classList.add('slide-in');
            
            // Set default date and time to current
            const now = new Date();
            const today = now.toISOString().split('T')[0];
            const currentTime = now.toTimeString().slice(0, 5);
            
            document.getElementById('incidentDate').value = today;
            document.getElementById('incidentTime').value = currentTime;
            
            // Display incident history
            displayIncidentHistory();
        }

        // Incident summary functions
        function showIncidentSummary() {
            hideAllForms();
            document.getElementById('incidentSummaryPage').classList.remove('hidden');
            document.getElementById('incidentSummaryPage').classList.add('slide-in');
            
            // Expand container for summary view
            const mainContainer = document.getElementById('mainContainer');
            mainContainer.classList.remove('max-w-md');
            mainContainer.classList.add('max-w-4xl');
            
            // Load and display summary data
            loadIncidentSummary();
        }

        function loadIncidentSummary() {
            // Show loading state
            document.getElementById('summaryLoading').classList.remove('hidden');
            document.getElementById('incidentSummaryList').innerHTML = '';
            document.getElementById('noSummaryData').classList.add('hidden');
            
            // Simulate loading delay
            setTimeout(() => {
                document.getElementById('summaryLoading').classList.add('hidden');
                
                if (incidentReports.length === 0) {
                    document.getElementById('noSummaryData').classList.remove('hidden');
                    updateSummaryStatistics();
                    return;
                }
                
                displayIncidentSummary();
                updateSummaryStatistics();
            }, 800);
        }

        function displayIncidentSummary() {
            const summaryContainer = document.getElementById('incidentSummaryList');
            
            // Sort reports by timestamp (newest first)
            const sortedReports = [...incidentReports].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            summaryContainer.innerHTML = sortedReports.map(report => {
                const reportDate = new Date(report.timestamp);
                const formattedDate = reportDate.toLocaleDateString('id-ID', {
                    weekday: 'short',
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
                const formattedTime = reportDate.toLocaleTimeString('id-ID', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const incidentDateTime = `${report.incidentDate} ${report.incidentTime}`;
                const incidentFormatted = new Date(incidentDateTime).toLocaleDateString('id-ID', {
                    weekday: 'short',
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                }) + ' ' + report.incidentTime;
                
                // Calculate damage and replacement counts
                const damageCount = report.equipmentDamage ? report.equipmentDamage.length : 0;
                const replacementCount = report.equipmentReplacement ? report.equipmentReplacement.length : 0;
                
                // Generate equipment impact summary
                let equipmentSummaryHtml = '';
                if (damageCount > 0 || replacementCount > 0) {
                    equipmentSummaryHtml = `
                        <div class="mt-3 p-3 bg-gray-50 border border-gray-200 rounded-lg">
                            <div class="text-xs font-medium text-gray-700 mb-2">ðŸ“¦ Dampak Inventaris:</div>
                            <div class="grid grid-cols-2 gap-2 text-xs">
                    `;
                    
                    if (damageCount > 0) {
                        equipmentSummaryHtml += `
                            <div class="bg-red-50 border border-red-200 p-2 rounded">
                                <div class="font-medium text-red-800">${damageCount} Alat Rusak</div>
                                <div class="text-red-600 text-xs mt-1">
                        `;
                        
                        report.equipmentDamage.slice(0, 2).forEach(damage => {
                            equipmentSummaryHtml += `â€¢ ${damage.inventoryName} (-${damage.quantity})<br>`;
                        });
                        
                        if (report.equipmentDamage.length > 2) {
                            equipmentSummaryHtml += `<span class="text-red-500">+${report.equipmentDamage.length - 2} lainnya</span>`;
                        }
                        
                        equipmentSummaryHtml += `</div></div>`;
                    }
                    
                    if (replacementCount > 0) {
                        equipmentSummaryHtml += `
                            <div class="bg-green-50 border border-green-200 p-2 rounded">
                                <div class="font-medium text-green-800">${replacementCount} Alat Diganti</div>
                                <div class="text-green-600 text-xs mt-1">
                        `;
                        
                        report.equipmentReplacement.slice(0, 2).forEach(replacement => {
                            equipmentSummaryHtml += `â€¢ ${replacement.inventoryName} (+${replacement.quantity})<br>`;
                        });
                        
                        if (report.equipmentReplacement.length > 2) {
                            equipmentSummaryHtml += `<span class="text-green-500">+${report.equipmentReplacement.length - 2} lainnya</span>`;
                        }
                        
                        equipmentSummaryHtml += `</div></div>`;
                    }
                    
                    equipmentSummaryHtml += `</div></div>`;
                }

                return `
                    <div class="bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center">
                                    <span class="text-xs font-bold text-red-800">#${report.id.slice(-4)}</span>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-900 text-sm">Laporan Insiden</h3>
                                    <p class="text-xs text-gray-600">${report.teacher} - ${report.class}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-xs text-gray-500">${formattedDate}</div>
                                <div class="text-xs text-gray-500">${formattedTime}</div>
                                ${(damageCount > 0 || replacementCount > 0) ? 
                                    '<span class="bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full text-xs font-medium mt-1 inline-block">ðŸ“¦ Inventaris</span>' : ''}
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-3 mb-3 text-xs">
                            <div>
                                <span class="font-medium text-gray-700">Waktu Kejadian:</span>
                                <div class="text-gray-900">${incidentFormatted}</div>
                            </div>
                            <div>
                                <span class="font-medium text-gray-700">Pelapor:</span>
                                <div class="text-gray-900">${report.reportedBy}</div>
                            </div>
                        </div>
                        
                        <div class="space-y-2">
                            <div>
                                <span class="font-medium text-gray-700 block mb-1 text-xs">ðŸ“ Ringkasan Kejadian:</span>
                                <p class="text-gray-900 text-xs bg-gray-50 p-2 rounded border line-clamp-2">${report.report}</p>
                            </div>
                            
                            <div>
                                <span class="font-medium text-gray-700 block mb-1 text-xs">âœ… Tindakan Diambil:</span>
                                <p class="text-gray-900 text-xs bg-gray-50 p-2 rounded border line-clamp-2">${report.actionTaken}</p>
                            </div>
                        </div>
                        
                        ${equipmentSummaryHtml}
                        
                        <div class="mt-3 pt-3 border-t border-gray-200 flex justify-between items-center">
                            <div class="text-xs text-gray-500">
                                ID: ${report.id}
                            </div>
                            <button onclick="viewIncidentDetails('${report.id}')" 
                                    class="text-blue-600 hover:text-blue-800 text-xs font-medium">
                                Lihat Detail â†’
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateSummaryStatistics() {
            const totalIncidents = incidentReports.length;
            const totalDamagedItems = incidentReports.reduce((sum, report) => 
                sum + (report.equipmentDamage ? report.equipmentDamage.length : 0), 0);
            const totalReplacedItems = incidentReports.reduce((sum, report) => 
                sum + (report.equipmentReplacement ? report.equipmentReplacement.length : 0), 0);
            
            // Calculate this month's incidents
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const thisMonthIncidents = incidentReports.filter(report => {
                const reportDate = new Date(report.timestamp);
                return reportDate.getMonth() === currentMonth && reportDate.getFullYear() === currentYear;
            }).length;
            
            document.getElementById('totalIncidents').textContent = totalIncidents;
            document.getElementById('totalDamagedItems').textContent = totalDamagedItems;
            document.getElementById('totalReplacedItems').textContent = totalReplacedItems;
            document.getElementById('thisMonthIncidents').textContent = thisMonthIncidents;
        }

        function filterIncidentsByMonth() {
            const selectedMonth = document.getElementById('monthFilter').value;
            // Implementation for month filtering would go here
            // For now, just refresh the display
            displayIncidentSummary();
        }

        function filterIncidentsByTeacher() {
            const selectedTeacher = document.getElementById('teacherFilter').value;
            // Implementation for teacher filtering would go here
            // For now, just refresh the display
            displayIncidentSummary();
        }

        function resetIncidentFilters() {
            document.getElementById('monthFilter').value = '';
            document.getElementById('teacherFilter').value = '';
            displayIncidentSummary();
        }

        function viewIncidentDetails(incidentId) {
            const report = incidentReports.find(r => r.id === incidentId);
            if (!report) return;
            
            // Create detailed view modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            
            const reportDate = new Date(report.timestamp);
            const formattedDate = reportDate.toLocaleDateString('id-ID', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            const formattedTime = reportDate.toLocaleTimeString('id-ID', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            const incidentDateTime = `${report.incidentDate} ${report.incidentTime}`;
            const incidentFormatted = new Date(incidentDateTime).toLocaleDateString('id-ID', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            }) + ' pukul ' + report.incidentTime;
            
            // Generate detailed equipment impact
            let detailedEquipmentHtml = '';
            if (report.equipmentDamage && report.equipmentDamage.length > 0) {
                detailedEquipmentHtml += `
                    <div class="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg">
                        <h4 class="font-semibold text-red-800 mb-2 text-sm">âš ï¸ Alat yang Rusak:</h4>
                        <div class="space-y-2">
                `;
                
                report.equipmentDamage.forEach(damage => {
                    detailedEquipmentHtml += `
                        <div class="text-sm text-red-700 bg-white p-2 rounded border">
                            <strong>${damage.inventoryName}</strong> - ${damage.quantity} unit
                            ${damage.specification !== 'general' ? `<br><span class="text-xs text-red-600">Spesifikasi: ${damage.specification}</span>` : ''}
                        </div>
                    `;
                });
                
                detailedEquipmentHtml += `</div></div>`;
            }
            
            if (report.equipmentReplacement && report.equipmentReplacement.length > 0) {
                detailedEquipmentHtml += `
                    <div class="mb-4 p-3 bg-green-50 border border-green-200 rounded-lg">
                        <h4 class="font-semibold text-green-800 mb-2 text-sm">ðŸ”„ Alat yang Diganti:</h4>
                        <div class="space-y-2">
                `;
                
                report.equipmentReplacement.forEach(replacement => {
                    detailedEquipmentHtml += `
                        <div class="text-sm text-green-700 bg-white p-2 rounded border">
                            <strong>${replacement.inventoryName}</strong> - ${replacement.quantity} unit
                            ${replacement.specification !== 'general' ? `<br><span class="text-xs text-green-600">Spesifikasi: ${replacement.specification}</span>` : ''}
                        </div>
                    `;
                });
                
                detailedEquipmentHtml += `</div></div>`;
            }
            
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-900">Detail Laporan Insiden #${report.id.slice(-4)}</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="p-3 bg-blue-50 border border-blue-200 rounded-lg">
                                <h4 class="font-semibold text-blue-900 mb-2">ðŸ‘¤ Informasi Pelapor</h4>
                                <div class="text-sm text-blue-800">
                                    <div><strong>Nama:</strong> ${report.teacher}</div>
                                    <div><strong>Kelas:</strong> ${report.class}</div>
                                    <div><strong>Dilaporkan oleh:</strong> ${report.reportedBy}</div>
                                </div>
                            </div>
                            
                            <div class="p-3 bg-purple-50 border border-purple-200 rounded-lg">
                                <h4 class="font-semibold text-purple-900 mb-2">ðŸ“… Waktu</h4>
                                <div class="text-sm text-purple-800">
                                    <div><strong>Kejadian:</strong> ${incidentFormatted}</div>
                                    <div><strong>Dilaporkan:</strong> ${formattedDate} ${formattedTime}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-4 bg-gray-50 border border-gray-200 rounded-lg">
                            <h4 class="font-semibold text-gray-900 mb-3">ðŸ“ Laporan Kejadian</h4>
                            <p class="text-gray-800 text-sm leading-relaxed">${report.report}</p>
                        </div>
                        
                        <div class="p-4 bg-gray-50 border border-gray-200 rounded-lg">
                            <h4 class="font-semibold text-gray-900 mb-3">âœ… Tindakan yang Dilakukan</h4>
                            <p class="text-gray-800 text-sm leading-relaxed">${report.actionTaken}</p>
                        </div>
                        
                        ${detailedEquipmentHtml}
                        
                        <div class="pt-4 border-t border-gray-200 text-xs text-gray-500">
                            <strong>ID Laporan:</strong> ${report.id}<br>
                            <strong>Email Pelapor:</strong> ${report.reportedByEmail}
                        </div>
                    </div>
                    
                    <div class="flex justify-end mt-6">
                        <button onclick="this.closest('.fixed').remove()" 
                                class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium hover:bg-gray-300 transition-colors">
                            Tutup
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function exportIncidentSummary() {
            if (incidentReports.length === 0) {
                showMessage('Tidak ada data laporan untuk diekspor.', 'warning');
                return;
            }
            
            // Create CSV content
            let csvContent = 'No,ID Laporan,Tanggal Kejadian,Waktu Kejadian,Guru,Kelas,Laporan,Tindakan,Alat Rusak,Alat Diganti,Pelapor,Tanggal Laporan\n';
            
            incidentReports.forEach((report, index) => {
                const reportDate = new Date(report.timestamp);
                const formattedReportDate = reportDate.toLocaleDateString('id-ID');
                const incidentDate = new Date(`${report.incidentDate} ${report.incidentTime}`).toLocaleDateString('id-ID');
                
                const damagedItems = report.equipmentDamage ? 
                    report.equipmentDamage.map(d => `${d.inventoryName} (${d.quantity})`).join('; ') : '-';
                const replacedItems = report.equipmentReplacement ? 
                    report.equipmentReplacement.map(r => `${r.inventoryName} (${r.quantity})`).join('; ') : '-';
                
                csvContent += `${index + 1},"${report.id.slice(-4)}","${incidentDate}","${report.incidentTime}","${report.teacher}","${report.class}","${report.report.replace(/"/g, '""')}","${report.actionTaken.replace(/"/g, '""')}","${damagedItems}","${replacedItems}","${report.reportedBy}","${formattedReportDate}"\n`;
            });
            
            // Create and download file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `Rekap_Laporan_Insiden_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showMessage('File rekap laporan berhasil diunduh!', 'success');
        }

        async function handleIncidentSubmit(event) {
            event.preventDefault();
            
            const teacher = document.getElementById('incidentTeacherSelect').value;
            const className = document.getElementById('incidentClassSelect').value;
            const incidentDate = document.getElementById('incidentDate').value;
            const incidentTime = document.getElementById('incidentTime').value;
            const report = document.getElementById('incidentReport').value;
            const actionTaken = document.getElementById('actionTaken').value;
            const submitBtn = document.getElementById('incidentSubmitBtn');
            
            // Show loading state
            submitBtn.textContent = 'Mengirim...';
            submitBtn.disabled = true;
            
            try {
                // Analyze report for equipment damage
                const damageAnalysis = analyzeEquipmentDamage(report);
                
                // Analyze replacement from action taken
                const replacementAnalysis = analyzeEquipmentReplacement(actionTaken);
                
                // Create incident report
                const incidentData = {
                    id: Date.now().toString(),
                    timestamp: new Date().toISOString(),
                    teacher: teacher,
                    class: className,
                    incidentDate: incidentDate,
                    incidentTime: incidentTime,
                    report: report,
                    actionTaken: actionTaken,
                    reportedBy: currentUser ? currentUser.nama_lengkap : 'Unknown User',
                    reportedByEmail: currentUser ? currentUser.email : 'unknown',
                    equipmentDamage: damageAnalysis.damages,
                    equipmentReplacement: replacementAnalysis,
                    inventoryImpact: damageAnalysis.inventoryChanges
                };
                
                // Debug logging
                console.log('=== ANALISIS LAPORAN INSIDEN ===');
                console.log('Laporan Kerusakan:', report);
                console.log('Tindakan yang Dilakukan:', actionTaken);
                console.log('Kerusakan Terdeteksi:', damageAnalysis.damages);
                console.log('Penggantian Terdeteksi:', replacementAnalysis);
                console.log('================================');
                
                // Update inventory based on damage and replacement
                updateInventoryFromIncident(incidentData);
                
                // Add to local storage
                incidentReports.push(incidentData);
                
                // Simulate sending to system
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                let successMessage = 'Laporan berhasil dikirim ke sistem!';
                if (damageAnalysis.damages.length > 0) {
                    successMessage += ` Data inventaris telah diperbarui untuk ${damageAnalysis.damages.length} alat yang rusak.`;
                }
                if (replacementAnalysis.length > 0) {
                    successMessage += ` ${replacementAnalysis.length} alat pengganti telah ditambahkan ke inventaris.`;
                }
                
                showMessage(successMessage, 'success');
                
                // Reset form
                document.getElementById('incidentFormPage').querySelector('form').reset();
                
                // Refresh the incident history display
                displayIncidentHistory();
                
                // Set default date and time again
                const now = new Date();
                const today = now.toISOString().split('T')[0];
                const currentTime = now.toTimeString().slice(0, 5);
                
                document.getElementById('incidentDate').value = today;
                document.getElementById('incidentTime').value = currentTime;
                
            } catch (error) {
                showMessage('Gagal mengirim laporan. Silakan coba lagi.', 'error');
            } finally {
                submitBtn.textContent = 'Kirim Laporan';
                submitBtn.disabled = false;
            }
        }

        // Equipment damage analysis functions
        function analyzeEquipmentDamage(reportText) {
            const damages = [];
            const inventoryChanges = [];
            const text = reportText.toLowerCase();
            
            // Damage indicators
            const damageWords = ['rusak', 'pecah', 'patah', 'retak', 'hancur', 'hilang', 'tidak berfungsi', 'error', 'mati', 'robek', 'sobek', 'tumpah', 'bocor', 'aus', 'buram', 'kotor', 'lengket', 'macet', 'kendor', 'lepas', 'putus'];
            
            // Extract specific equipment mentions with specifications from the report
            const specificEquipmentPatterns = [
                // Gelas Kimia dengan ukuran spesifik (100ml, 250ml, 300ml, 500ml, 600ml)
                /(?:gelas kimia|beaker)\s*(?:ukuran\s*)?(\d+)\s*ml/gi,
                /(\d+)\s*ml\s*(?:gelas kimia|beaker)/gi,
                
                // Silinder Ukur dengan ukuran spesifik (25ml, 50ml, 250ml)
                /(?:silinder ukur|gelas ukur|measuring cylinder)\s*(?:ukuran\s*)?(\d+)\s*ml/gi,
                /(\d+)\s*ml\s*(?:silinder ukur|gelas ukur|measuring cylinder)/gi,
                
                // Labu Erlenmeyer dengan ukuran spesifik (200ml, 500ml, 1000ml)
                /(?:labu erlenmeyer|erlenmeyer|flask)\s*(?:ukuran\s*)?(\d+)\s*ml/gi,
                /(\d+)\s*ml\s*(?:labu erlenmeyer|erlenmeyer|flask)/gi,
                
                // Corong dengan diameter spesifik (Ã˜ 16-50 mm, Ã˜ 16-75 mm)
                /corong\s*(?:kaca\s*)?(?:diameter\s*|Ã¸\s*)?(\d+)(?:-(\d+))?\s*mm/gi,
                /(?:diameter\s*|Ã¸\s*)?(\d+)(?:-(\d+))?\s*mm\s*corong/gi,
                /corong\s*(?:kaca|plastik)/gi,
                
                // Beban dengan berat spesifik (10gr, 20gr, 30gr, 50gr, 100gr)
                /beban\s*(?:berkait|bercelah)?\s*(\d+)\s*(?:gr|gram)/gi,
                /(\d+)\s*(?:gr|gram)\s*beban/gi,
                
                // Panci Bedah dengan ukuran spesifik (20x20cm, 26x30cm)
                /panci bedah\s*(?:ukuran\s*)?(\d+)\s*x\s*(\d+)\s*cm/gi,
                /(\d+)\s*x\s*(\d+)\s*cm\s*panci bedah/gi,
                
                // Mikroskop dengan tipe spesifik (monokuler, binokuler, stereo, listrik)
                /mikroskop\s*(monokuler|binokuler|stereo)(?:\s*(listrik|manual|u\/lnjt))?/gi,
                /(monokuler|binokuler|stereo)\s*mikroskop/gi,
                /mikroskop\s*(listrik)/gi,
                
                // Termometer dengan tipe spesifik (klinis, raksa, alkohol, dinding)
                /termometer\s*(klinis|raksa|alkohol|dinding)/gi,
                /(klinis|raksa|alkohol|dinding)\s*termometer/gi,
                
                // Bunsen dengan ukuran spesifik (besar, kecil)
                /(?:bunsen|pembakar)\s*(besar|kecil)/gi,
                /(besar|kecil)\s*(?:bunsen|pembakar)/gi,
                
                // Tabung Reaksi dengan ukuran spesifik (besar, sedang, kecil)
                /tabung reaksi\s*(besar|sedang|kecil)/gi,
                /(besar|sedang|kecil)\s*tabung reaksi/gi,
                
                // Plat Tetes dengan ukuran spesifik (besar, kecil)
                /plat tetes\s*(besar|kecil)/gi,
                /(besar|kecil)\s*plat tetes/gi,
                
                // Alat Bedah dengan tipe spesifik (set, box kulit, box kayu)
                /alat bedah\s*(?:set\s*)?(box\s*(?:kulit|kayu))?/gi,
                /(box\s*(?:kulit|kayu))\s*alat bedah/gi,
                /alat bedah\s*set/gi,
                
                // Stetoscope dengan tipe spesifik (tipe 1, 2, 3)
                /stetoscope\s*(?:tipe\s*)?(\d+)/gi,
                /tipe\s*(\d+)\s*stetoscope/gi,
                
                // Aquarium dengan tipe spesifik (besar/kecil, kaca persegi/bulat)
                /aquarium\s*(besar|kecil)?\s*(kaca\s*(?:persegi|bulat))?/gi,
                /(besar|kecil)?\s*(kaca\s*(?:persegi|bulat))?\s*aquarium/gi,
                
                // Lensa dengan tipe spesifik (bikonveks, bikonkaf, tebal/sedang)
                /lensa\s*(bikonveks|bikonkaf)(?:\s*(tebal|sedang))?/gi,
                /(bikonveks|bikonkaf)\s*lensa/gi,
                
                // Stopwatch dengan tipe spesifik (air, biasa)
                /stopwatch\s*(air|biasa)/gi,
                /(air|biasa)\s*stopwatch/gi,
                
                // Neraca dengan tipe spesifik (311, O-Haouse)
                /neraca\s*(311|o-haouse)/gi,
                /(311|o-haouse)\s*neraca/gi,
                
                // Katrol dengan tipe spesifik (1 roda, 2 roda)
                /katrol\s*(\d+)\s*roda/gi,
                /(\d+)\s*roda\s*katrol/gi,
                
                // Asbes dengan kondisi spesifik (baik, kurang baik)
                /asbes\s*(?:kondisi\s*)?(baik|kurang)/gi,
                /(baik|kurang)\s*asbes/gi,
                
                // Botol Labu Didih dengan ukuran (besar, kecil)
                /botol labu didih\s*(besar|kecil)/gi,
                /(besar|kecil)\s*botol labu didih/gi,
                
                // Alu + Mortar dengan ukuran (besar, kecil)
                /(?:alu|mortar)\s*(?:\+\s*mortar|\+\s*alu)?\s*(besar|kecil)/gi,
                /(besar|kecil)\s*(?:alu|mortar)/gi,
                
                // Basicmeter dengan kondisi
                /basicmeter/gi,
                
                // Pompa dengan tipe (pascal, isap, tekan)
                /pompa\s*(pascal|isap|tekan)/gi,
                /(pascal|isap|tekan)\s*pompa/gi,
                
                // Manometer dengan tipe
                /manometer\s*(terbuka)/gi,
                /(terbuka)\s*manometer/gi,
                
                // Kit dengan tipe spesifik
                /kit\s*(elektrostatik|listrik|magnet|mekanika|hidrostatika|panas|optik)/gi,
                /(elektrostatik|listrik|magnet|mekanika|hidrostatika|panas|optik)\s*kit/gi,
                
                // Cermin dengan tipe (datar, datar lipat)
                /cermin\s*(datar)(?:\s*(lipat))?/gi,
                /(datar)(?:\s*(lipat))?\s*cermin/gi,
                
                // Magnet dengan tipe (batang, U)
                /magnet\s*(batang|u)/gi,
                /(batang|u)\s*magnet/gi,
                
                // Garpu Tala
                /garpu tala/gi,
                
                // Slinki dengan tipe
                /slinki(?:\s*(cadangan))?/gi,
                
                // Respirometer
                /respirometer/gi,
                
                // Kotak Genetika dengan tipe (2 warna box kayu, 2 warna box plastik, 5 warna box plastik)
                /kotak genetika\s*(?:(\d+)\s*warna)?\s*(box\s*(?:kayu|plastik))?/gi,
                /(\d+)\s*warna\s*box\s*(kayu|plastik)\s*kotak genetika/gi,
                
                // Model dengan tipe spesifik (otak, mata, telinga, jantung, kulit, ginjal, rangka, molekul)
                /model\s*(otak|mata|telinga|jantung|kulit|ginjal|rangka|molekul)/gi,
                /(otak|mata|telinga|jantung|kulit|ginjal|rangka|molekul)\s*model/gi,
                
                // Torso dengan tipe (wanita, pria)
                /torso\s*(wanita|pria)/gi,
                /(wanita|pria)\s*torso/gi,
                
                // Carta/Poster dengan tipe spesifik
                /(?:carta|poster)\s*([a-zA-Z\s]+)/gi,
                
                // Alat Peraga dengan tipe spesifik
                /alat peraga\s*([a-zA-Z\s]+)/gi,
                
                // Perangkat Perawatan Mikro
                /perangkat perawatan mikro/gi,
                
                // Kaca Benda dan Kaca Penutup
                /kaca\s*(benda|penutup)/gi,
                /(benda|penutup)\s*kaca/gi,
                
                // Lup
                /lup/gi,
                
                // Papan Bedah
                /papan bedah/gi,
                
                // Spygmomanometer dan Tensimeter
                /(?:spygmomanometer|tensimeter)\s*(digital)?/gi,
                /(digital)\s*(?:spygmomanometer|tensimeter)/gi,
                
                // Auksanometer
                /auksanometer/gi,
                
                // Kuadrat
                /kuadrat/gi,
                
                // Insektarium
                /insektarium/gi,
                
                // Kartu Nutrisi
                /kartu nutrisi/gi,
                
                // Bejana dengan tipe (berhubungan, kapiler)
                /bejana\s*(berhubungan|kapiler)/gi,
                /(berhubungan|kapiler)\s*bejana/gi,
                
                // Alat Hukum Boyle
                /alat hukum boyle/gi,
                
                // Pipa dengan tipe (Y, kaca)
                /pipa\s*(y|kaca)/gi,
                /(y|kaca)\s*pipa/gi,
                
                // Ohmeter, Amperemeter, Multitester
                /(?:ohmeter|amperemeter|multitester)/gi,
                
                // Shunt
                /shunt/gi,
                
                // Catu Daya/Power Supply
                /(?:catu daya|power supply)/gi,
                
                // Kotak Baterai
                /kotak baterai/gi,
                
                // Batang Pengaduk
                /batang pengaduk/gi,
                
                // Cawan Petri
                /cawan petri/gi,
                
                // Kaki Tiga
                /kaki tiga/gi,
                
                // Kasa
                /kasa/gi,
                
                // Sikat Tabung Reaksi
                /sikat tabung reaksi/gi,
                
                // Statif dengan tipe (bentuk A, batang)
                /statif\s*(?:bentuk\s*)?(a|batang)?/gi,
                /(bentuk\s*a|batang)\s*statif/gi,
                
                // Klem dengan tipe (universal, boss head)
                /klem\s*(universal|boss head)/gi,
                /(universal|boss head)\s*klem/gi,
                
                // Penjepit Tabung Reaksi
                /penjepit tabung reaksi/gi,
                
                // Rak Tabung Reaksi
                /rak tabung reaksi/gi,
                
                // Keranjang Serangga
                /keranjang serangga/gi,
                
                // Insectnet
                /insectnet/gi,
                
                // pH Meter
                /ph meter/gi,
                
                // Teleskop
                /teleskop/gi,
                
                // Jangka Sorong
                /jangka sorong/gi,
                
                // Perkakas Elektronika
                /perkakas elektronika/gi,
                
                // Mikrometer
                /mikrometer/gi,
                
                // Pipet Tetes
                /pipet tetes/gi,
                /pipet/gi,
                
                // Bola Dunia
                /bola dunia/gi,
                /globe/gi,
                
                // Tata Surya
                /tata surya/gi,
                
                // Preparat
                /preparat/gi
            ];
            
            // Check for specific equipment damage with specifications
            specificEquipmentPatterns.forEach(pattern => {
                const matches = [...text.matchAll(pattern)];
                matches.forEach(match => {
                    const fullMatch = match[0];
                    const hasDamage = damageWords.some(word => 
                        text.includes(word) && 
                        Math.abs(text.indexOf(word) - text.indexOf(fullMatch)) < 50
                    );
                    
                    if (hasDamage) {
                        // Extract quantity from nearby text
                        const beforeText = text.substring(Math.max(0, text.indexOf(fullMatch) - 30), text.indexOf(fullMatch));
                        const afterText = text.substring(text.indexOf(fullMatch) + fullMatch.length, text.indexOf(fullMatch) + fullMatch.length + 30);
                        const contextText = beforeText + fullMatch + afterText;
                        
                        const quantityMatch = contextText.match(/(\d+)\s*(?:buah|unit|set|pack|pasang)?/);
                        const quantity = quantityMatch ? parseInt(quantityMatch[1]) : 1;
                        
                        // Find exact matching inventory item based on specifications
                        const exactMatch = findExactInventoryMatch(fullMatch, match);
                        
                        if (exactMatch) {
                            damages.push({
                                keyword: fullMatch,
                                inventoryName: exactMatch.nama,
                                inventoryItem: exactMatch,
                                quantity: quantity,
                                specification: extractSpecification(fullMatch, match)
                            });
                            
                            inventoryChanges.push({
                                action: 'damage',
                                equipment: exactMatch.nama,
                                quantity: quantity
                            });
                        }
                    }
                });
            });
            
            // Fallback: Check for general equipment mentions without specifications
            const generalEquipmentKeywords = [
                'mikroskop', 'gelas kimia', 'tabung reaksi', 'pipet tetes', 'corong', 'labu erlenmeyer',
                'silinder ukur', 'bunsen', 'termometer', 'beban', 'katrol', 'lensa', 'cermin',
                'magnet', 'stopwatch', 'neraca', 'panci bedah', 'alat bedah', 'stetoscope',
                'aquarium', 'plat tetes', 'batang pengaduk', 'cawan petri', 'kaca benda',
                'kaca penutup', 'asbes', 'kasa', 'statif', 'klem', 'model', 'carta', 'poster'
            ];
            
            generalEquipmentKeywords.forEach(keyword => {
                if (text.includes(keyword)) {
                    const hasDamage = damageWords.some(word => 
                        text.includes(word) && 
                        Math.abs(text.indexOf(word) - text.indexOf(keyword)) < 50
                    );
                    
                    if (hasDamage) {
                        // Extract quantity
                        const keywordIndex = text.indexOf(keyword);
                        const beforeText = text.substring(Math.max(0, keywordIndex - 30), keywordIndex);
                        const afterText = text.substring(keywordIndex + keyword.length, keywordIndex + keyword.length + 30);
                        const contextText = beforeText + keyword + afterText;
                        
                        const quantityMatch = contextText.match(/(\d+)\s*(?:buah|unit|set|pack|pasang)?/);
                        const quantity = quantityMatch ? parseInt(quantityMatch[1]) : 1;
                        
                        // Find best matching inventory item (prefer items with higher quantity)
                        const matchingItems = inventoryData.filter(item => 
                            item.nama.toLowerCase().includes(keyword) && item.jumlah > 0
                        );
                        
                        if (matchingItems.length > 0) {
                            // Sort by quantity (descending) to prefer items with more stock
                            const bestMatch = matchingItems.sort((a, b) => b.jumlah - a.jumlah)[0];
                            
                            // Check if this damage hasn't been recorded yet
                            const alreadyRecorded = damages.some(d => d.inventoryName === bestMatch.nama);
                            if (!alreadyRecorded) {
                                damages.push({
                                    keyword: keyword,
                                    inventoryName: bestMatch.nama,
                                    inventoryItem: bestMatch,
                                    quantity: quantity,
                                    specification: 'general'
                                });
                                
                                inventoryChanges.push({
                                    action: 'damage',
                                    equipment: bestMatch.nama,
                                    quantity: quantity
                                });
                            }
                        }
                    }
                }
            });
            
            return { damages, inventoryChanges };
        }
        
        // Helper function to find exact inventory match based on specifications
        function findExactInventoryMatch(fullMatch, regexMatch) {
            const text = fullMatch.toLowerCase();
            
            // === GLASSWARE MATCHING ===
            // Gelas Kimia matching - exact volume specification
            if (text.includes('gelas kimia') || text.includes('beaker')) {
                const volume = regexMatch[1];
                if (volume) {
                    // Cari berdasarkan volume yang tepat
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('gelas kimia') && 
                        item.keterangan.toLowerCase().includes(`ukuran ${volume} ml`)
                    );
                } else {
                    // Jika tidak ada volume spesifik, ambil yang paling banyak stoknya
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('gelas kimia')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Silinder Ukur matching - exact volume specification
            if (text.includes('silinder ukur') || text.includes('gelas ukur') || text.includes('measuring cylinder')) {
                const volume = regexMatch[1];
                if (volume) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('silinder ukur') && 
                        item.keterangan.toLowerCase().includes(`ukuran ${volume} ml`)
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('silinder ukur')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Labu Erlenmeyer matching - exact volume specification
            if (text.includes('labu erlenmeyer') || text.includes('erlenmeyer') || text.includes('flask')) {
                const volume = regexMatch[1];
                if (volume) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('labu erlenmeyer') && 
                        item.keterangan.toLowerCase().includes(`ukuran ${volume} ml`)
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('labu erlenmeyer')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Cawan Petri matching
            if (text.includes('cawan petri') || text.includes('petri dish')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('cawan petri')
                );
            }
            
            // Pipa Kaca matching
            if (text.includes('pipa kaca') || text.includes('glass tube')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('pipa kaca')
                );
            }
            
            // Kaca Benda dan Kaca Penutup matching
            if (text.includes('kaca benda') || text.includes('object glass')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('kaca benda')
                );
            }
            
            if (text.includes('kaca penutup') || text.includes('cover glass')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('kaca penutup')
                );
            }
            
            // Corong matching - exact diameter specification or material
            if (text.includes('corong')) {
                if (regexMatch[1] && regexMatch[2]) {
                    // Diameter range pattern
                    const diameter1 = regexMatch[1];
                    const diameter2 = regexMatch[2];
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('corong') && 
                        item.keterangan.toLowerCase().includes(`Ã¸ ${diameter1}-${diameter2}`)
                    );
                } else if (regexMatch[1]) {
                    // Single diameter
                    const diameter = regexMatch[1];
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('corong') && 
                        item.keterangan.toLowerCase().includes(`Ã¸ ${diameter}`)
                    );
                } else if (text.includes('kaca')) {
                    // Corong kaca
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('corong') && 
                        item.keterangan.toLowerCase().includes('kaca')
                    );
                } else if (text.includes('plastik')) {
                    // Corong plastik
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('corong') && 
                        item.keterangan.toLowerCase().includes('plastik')
                    );
                }
            }
            
            // Beban matching - exact weight specification
            if (text.includes('beban')) {
                const weight = regexMatch[1];
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('beban berkait') && 
                    item.keterangan.toLowerCase().includes(`${weight} gr`)
                );
            }
            
            // Panci Bedah matching - exact size specification
            if (text.includes('panci bedah')) {
                const size1 = regexMatch[1];
                const size2 = regexMatch[2];
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('panci bedah') && 
                    item.keterangan.toLowerCase().includes(`ukuran ${size1} x ${size2}`)
                );
            }
            
            // === MIKROSKOP DAN AKSESORIS MATCHING ===
            // Mikroskop matching - exact type and power specification
            if (text.includes('mikroskop') || text.includes('microscope')) {
                const type = regexMatch[1];
                const power = regexMatch[2];
                
                if (type && power) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('mikroskop') && 
                        item.keterangan.toLowerCase().includes(type) &&
                        item.keterangan.toLowerCase().includes(power)
                    );
                } else if (type) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('mikroskop') && 
                        item.keterangan.toLowerCase().includes(type)
                    );
                } else if (power === 'listrik') {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('mikroskop') && 
                        item.keterangan.toLowerCase().includes('listrik')
                    );
                } else {
                    // Default ke mikroskop dengan stok terbanyak
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('mikroskop')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Perangkat Perawatan Mikro matching
            if (text.includes('perangkat perawatan mikro') || text.includes('maintenance kit')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('perangkat perawatan mikro')
                );
            }
            
            // Lup matching
            if (text.includes('lup') || text.includes('magnifying glass')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('lup')
                );
            }
            
            // === ALAT MEDIS MATCHING ===
            // Panci Bedah matching - exact size specification
            if (text.includes('panci bedah') || text.includes('dissecting tray')) {
                const size1 = regexMatch[1];
                const size2 = regexMatch[2];
                if (size1 && size2) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('panci bedah') && 
                        item.keterangan.toLowerCase().includes(`ukuran ${size1} x ${size2}`)
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('panci bedah')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Papan Bedah matching
            if (text.includes('papan bedah') || text.includes('dissecting board')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('papan bedah')
                );
            }
            
            // Alat Bedah matching - exact type specification
            if (text.includes('alat bedah') || text.includes('dissecting kit')) {
                const type = regexMatch[1];
                if (type && type.includes('box')) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('alat bedah') && 
                        item.keterangan.toLowerCase().includes(type)
                    );
                } else if (text.includes('set')) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('alat bedah') && 
                        item.keterangan.toLowerCase().includes('set') &&
                        !item.keterangan.toLowerCase().includes('box')
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('alat bedah')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Stetoscope matching - exact type specification
            if (text.includes('stetoscope') || text.includes('stetoskop') || text.includes('stethoscope')) {
                const type = regexMatch[1];
                if (type) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('stetoscope') && 
                        item.keterangan.toLowerCase().includes(`tipe ${type}`)
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('stetoscope')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Spygmomanometer/Tensimeter matching
            if (text.includes('spygmomanometer') || text.includes('tensimeter') || text.includes('blood pressure')) {
                const type = regexMatch[1];
                if (type === 'digital') {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('tensimeter digital')
                    );
                } else {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('spygmomanometer')
                    );
                }
            }
            
            // Termometer matching - exact type specification
            if (text.includes('termometer') || text.includes('thermometer')) {
                const type = regexMatch[1];
                if (type) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('termometer') && 
                        item.nama.toLowerCase().includes(type)
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('termometer')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // === ALAT BIOLOGI MATCHING ===
            // Respirometer matching
            if (text.includes('respirometer')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('respirometer')
                );
            }
            
            // Kotak Genetika matching - exact color and material specification
            if (text.includes('kotak genetika') || text.includes('genetic box')) {
                const colors = regexMatch[1];
                const material = regexMatch[2];
                
                if (colors && material) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('kotak genetika') && 
                        item.keterangan.toLowerCase().includes(`${colors} warna`) &&
                        item.keterangan.toLowerCase().includes(material)
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('kotak genetika')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Auksanometer matching
            if (text.includes('auksanometer')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('auksanometer')
                );
            }
            
            // Kuadrat matching
            if (text.includes('kuadrat') || text.includes('quadrat')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('kuadrat')
                );
            }
            
            // Aquarium matching - exact size and shape specification
            if (text.includes('aquarium') || text.includes('akuarium')) {
                const size = regexMatch[1];
                const shape = regexMatch[2];
                
                if (size && shape) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('aquarium') && 
                        item.keterangan.toLowerCase().includes(size) &&
                        item.keterangan.toLowerCase().includes(shape)
                    );
                } else if (size) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('aquarium') && 
                        item.keterangan.toLowerCase().includes(size)
                    );
                } else if (shape) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('aquarium') && 
                        item.keterangan.toLowerCase().includes(shape)
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('aquarium')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Insektarium matching
            if (text.includes('insektarium') || text.includes('insect cage')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('insektarium')
                );
            }
            
            // Kartu Nutrisi matching
            if (text.includes('kartu nutrisi') || text.includes('nutrition card')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('kartu nutrisi')
                );
            }
            
            // Keranjang Serangga matching
            if (text.includes('keranjang serangga') || text.includes('insect basket')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('keranjang serangga')
                );
            }
            
            // Insectnet matching
            if (text.includes('insectnet') || text.includes('jaring serangga') || text.includes('butterfly net')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('insectnet')
                );
            }
            
            // === ALAT KIMIA MATCHING ===
            // Bunsen matching - exact size specification
            if (text.includes('bunsen') || text.includes('pembakar')) {
                const size = regexMatch[1];
                if (size) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('bunsen') && 
                        item.nama.toLowerCase().includes(size)
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('bunsen')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Tabung Reaksi matching - exact size specification
            if (text.includes('tabung reaksi') || text.includes('tabung')) {
                const size = regexMatch[1];
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('tabung reaksi') && 
                    item.keterangan.toLowerCase().includes(size)
                );
            }
            
            // Plat Tetes matching - exact size specification
            if (text.includes('plat tetes')) {
                const size = regexMatch[1];
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('plat tetes') && 
                    item.nama.toLowerCase().includes(size)
                );
            }
            
            // Alat Bedah matching - exact type specification
            if (text.includes('alat bedah')) {
                const type = regexMatch[1];
                if (type && type.includes('box')) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('alat bedah') && 
                        item.keterangan.toLowerCase().includes(type)
                    );
                } else if (text.includes('set')) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('alat bedah') && 
                        item.keterangan.toLowerCase().includes('set') &&
                        !item.keterangan.toLowerCase().includes('box')
                    );
                } else {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('alat bedah') && 
                        !item.keterangan.toLowerCase().includes('box') &&
                        !item.keterangan.toLowerCase().includes('set')
                    );
                }
            }
            
            // Stetoscope matching - exact type specification
            if (text.includes('stetoscope') || text.includes('stetoskop')) {
                const type = regexMatch[1];
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('stetoscope') && 
                    item.keterangan.toLowerCase().includes(`tipe ${type}`)
                );
            }
            
            // Aquarium matching - exact size and shape specification
            if (text.includes('aquarium')) {
                const size = regexMatch[1];
                const shape = regexMatch[2];
                
                if (size && shape) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('aquarium') && 
                        item.keterangan.toLowerCase().includes(size) &&
                        item.keterangan.toLowerCase().includes(shape)
                    );
                } else if (size) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('aquarium') && 
                        item.keterangan.toLowerCase().includes(size)
                    );
                } else if (shape) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('aquarium') && 
                        item.keterangan.toLowerCase().includes(shape)
                    );
                }
            }
            
            // Lensa matching - exact type and thickness specification
            if (text.includes('lensa')) {
                const type = regexMatch[1];
                const thickness = regexMatch[2];
                
                if (type && thickness) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('lensa') && 
                        item.nama.toLowerCase().includes(type) &&
                        item.keterangan.toLowerCase().includes(thickness)
                    );
                } else if (type) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('lensa') && 
                        item.nama.toLowerCase().includes(type)
                    );
                }
            }
            
            // Stopwatch matching - exact type specification
            if (text.includes('stopwatch')) {
                const type = regexMatch[1];
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('stopwatch') && 
                    item.nama.toLowerCase().includes(type)
                );
            }
            
            // Neraca matching - exact type specification
            if (text.includes('neraca')) {
                const type = regexMatch[1];
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('neraca') && 
                    item.nama.toLowerCase().includes(type)
                );
            }
            
            // Katrol matching - exact wheel count specification
            if (text.includes('katrol')) {
                const wheels = regexMatch[1];
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('katrol') && 
                    item.nama.toLowerCase().includes(`${wheels} roda`)
                );
            }
            
            // Botol Labu Didih matching - exact size specification
            if (text.includes('botol labu didih')) {
                const size = regexMatch[1];
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('botol labu didih') && 
                    item.keterangan.toLowerCase().includes(size)
                );
            }
            
            // Alu + Mortar matching - exact size specification
            if (text.includes('alu') || text.includes('mortar')) {
                const size = regexMatch[1];
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('alu + mortar') && 
                    item.keterangan.toLowerCase().includes(size)
                );
            }
            
            // Basicmeter matching
            if (text.includes('basicmeter')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('basicmeter')
                );
            }
            
            // Pompa matching - exact type specification
            if (text.includes('pompa')) {
                const type = regexMatch[1];
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('pompa') && 
                    item.nama.toLowerCase().includes(type)
                );
            }
            
            // Manometer matching - exact type specification
            if (text.includes('manometer')) {
                const type = regexMatch[1];
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('manometer') && 
                    item.nama.toLowerCase().includes(type)
                );
            }
            
            // Kit matching - exact type specification
            if (text.includes('kit')) {
                const type = regexMatch[1];
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('kit') && 
                    item.nama.toLowerCase().includes(type)
                );
            }
            
            // Cermin matching - exact type specification
            if (text.includes('cermin')) {
                const type = regexMatch[1];
                const subtype = regexMatch[2];
                
                if (type && subtype) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('cermin') && 
                        item.nama.toLowerCase().includes(type) &&
                        item.nama.toLowerCase().includes(subtype)
                    );
                } else if (type) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('cermin') && 
                        item.nama.toLowerCase().includes(type)
                    );
                }
            }
            
            // Magnet matching - exact type specification
            if (text.includes('magnet')) {
                const type = regexMatch[1];
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('magnet') && 
                    item.nama.toLowerCase().includes(type)
                );
            }
            
            // Garpu Tala matching
            if (text.includes('garpu tala')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('garpu tala')
                );
            }
            
            // Slinki matching
            if (text.includes('slinki')) {
                const type = regexMatch[1];
                if (type === 'cadangan') {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('slinki') && 
                        item.keterangan.toLowerCase().includes('cadangan')
                    );
                } else {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('slinki') && 
                        !item.keterangan.toLowerCase().includes('cadangan')
                    );
                }
            }
            
            // Respirometer matching
            if (text.includes('respirometer')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('respirometer')
                );
            }
            
            // Kotak Genetika matching - exact color and material specification
            if (text.includes('kotak genetika')) {
                const colors = regexMatch[1];
                const material = regexMatch[2];
                
                if (colors && material) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('kotak genetika') && 
                        item.keterangan.toLowerCase().includes(`${colors} warna`) &&
                        item.keterangan.toLowerCase().includes(material)
                    );
                }
            }
            
            // Model matching - exact type specification
            if (text.includes('model')) {
                const type = regexMatch[1];
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('model') && 
                    item.nama.toLowerCase().includes(type)
                );
            }
            
            // Torso matching - exact gender specification
            if (text.includes('torso')) {
                const gender = regexMatch[1];
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('torso') && 
                    item.nama.toLowerCase().includes(gender)
                );
            }
            
            // Carta/Poster matching - exact topic specification
            if (text.includes('carta') || text.includes('poster')) {
                const topic = regexMatch[1];
                if (topic) {
                    return inventoryData.find(item => 
                        (item.nama.toLowerCase().includes('carta') || item.nama.toLowerCase().includes('poster')) && 
                        item.nama.toLowerCase().includes(topic.toLowerCase())
                    );
                }
            }
            
            // Alat Peraga matching - exact system specification
            if (text.includes('alat peraga')) {
                const system = regexMatch[1];
                if (system) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('alat peraga') && 
                        item.nama.toLowerCase().includes(system.toLowerCase())
                    );
                }
            }
            
            // === ALAT FISIKA MATCHING ===
            // Kit matching - exact type specification
            if (text.includes('kit')) {
                const type = regexMatch[1];
                if (type) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('kit') && 
                        item.nama.toLowerCase().includes(type)
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('kit')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Garpu Tala matching
            if (text.includes('garpu tala') || text.includes('tuning fork')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('garpu tala')
                );
            }
            
            // Slinki matching
            if (text.includes('slinki') || text.includes('slinky')) {
                const type = regexMatch[1];
                if (type === 'cadangan') {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('slinki') && 
                        item.keterangan.toLowerCase().includes('cadangan')
                    );
                } else {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('slinki') && 
                        !item.keterangan.toLowerCase().includes('cadangan')
                    );
                }
            }
            
            // Beban matching - exact weight specification
            if (text.includes('beban') || text.includes('weight')) {
                const weight = regexMatch[1];
                if (weight) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('beban berkait') && 
                        item.keterangan.toLowerCase().includes(`${weight} gr`)
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('beban')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Katrol matching - exact wheel count specification
            if (text.includes('katrol') || text.includes('pulley')) {
                const wheels = regexMatch[1];
                if (wheels) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('katrol') && 
                        item.nama.toLowerCase().includes(`${wheels} roda`)
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('katrol')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Magnet matching - exact type specification
            if (text.includes('magnet')) {
                const type = regexMatch[1];
                if (type) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('magnet') && 
                        item.nama.toLowerCase().includes(type)
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('magnet')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Pompa matching - exact type specification
            if (text.includes('pompa') || text.includes('pump')) {
                const type = regexMatch[1];
                if (type) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('pompa') && 
                        item.nama.toLowerCase().includes(type)
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('pompa')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Bejana matching - exact type specification
            if (text.includes('bejana')) {
                const type = regexMatch[1];
                if (type) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('bejana') && 
                        item.nama.toLowerCase().includes(type)
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('bejana')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Alat Hukum Boyle matching
            if (text.includes('alat hukum boyle') || text.includes("boyle's law")) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('alat hukum boyle')
                );
            }
            
            // Manometer matching - exact type specification
            if (text.includes('manometer')) {
                const type = regexMatch[1];
                if (type) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('manometer') && 
                        item.nama.toLowerCase().includes(type)
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('manometer')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Pipa matching - exact type specification
            if (text.includes('pipa y') || text.includes('y tube')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('pipa y')
                );
            }
            
            // Stopwatch matching - exact type specification
            if (text.includes('stopwatch') || text.includes('chronometer')) {
                const type = regexMatch[1];
                if (type) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('stopwatch') && 
                        item.nama.toLowerCase().includes(type)
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('stopwatch')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Jangka Sorong matching
            if (text.includes('jangka sorong') || text.includes('caliper')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('jangka sorong')
                );
            }
            
            // Mikrometer matching
            if (text.includes('mikrometer') || text.includes('micrometer')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('mikrometer')
                );
            }
            
            // Teleskop matching
            if (text.includes('teleskop') || text.includes('telescope')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('teleskop')
                );
            }
            
            // === ALAT OPTIK MATCHING ===
            // Lensa matching - exact type and thickness specification
            if (text.includes('lensa') || text.includes('lens')) {
                const type = regexMatch[1];
                const thickness = regexMatch[2];
                
                if (type && thickness) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('lensa') && 
                        item.nama.toLowerCase().includes(type) &&
                        item.keterangan.toLowerCase().includes(thickness)
                    );
                } else if (type) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('lensa') && 
                        item.nama.toLowerCase().includes(type)
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('lensa')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Cermin matching - exact type specification
            if (text.includes('cermin') || text.includes('mirror')) {
                const type = regexMatch[1];
                const subtype = regexMatch[2];
                
                if (type && subtype) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('cermin') && 
                        item.nama.toLowerCase().includes(type) &&
                        item.nama.toLowerCase().includes(subtype)
                    );
                } else if (type) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('cermin') && 
                        item.nama.toLowerCase().includes(type)
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('cermin')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Prisma matching
            if (text.includes('prisma') || text.includes('prism')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('prisma')
                );
            }
            
            // === ALAT ELEKTRONIK MATCHING ===
            // Ohmeter matching
            if (text.includes('ohmeter') || text.includes('ohmmeter')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('ohmeter')
                );
            }
            
            // Amperemeter matching
            if (text.includes('amperemeter') || text.includes('ammeter')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('amperemeter')
                );
            }
            
            // Multitester matching
            if (text.includes('multitester') || text.includes('multimeter') || text.includes('avometer')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('multitester')
                );
            }
            
            // Basicmeter matching
            if (text.includes('basicmeter') || text.includes('basic meter')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('basicmeter')
                );
            }
            
            // Shunt matching
            if (text.includes('shunt')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('shunt')
                );
            }
            
            // Catu Daya/Power Supply matching
            if (text.includes('catu daya') || text.includes('power supply') || text.includes('adaptor')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('catu daya')
                );
            }
            
            // Kotak Baterai matching
            if (text.includes('kotak baterai') || text.includes('battery box')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('kotak baterai')
                );
            }
            
            // Perkakas Elektronika matching
            if (text.includes('perkakas elektronika') || text.includes('electronic tools')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('perkakas elektronika')
                );
            }
            
            // === ALAT KIMIA LANJUTAN ===
            // Batang Pengaduk matching
            if (text.includes('batang pengaduk') || text.includes('stirring rod')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('batang pengaduk')
                );
            }
            
            // Kaki Tiga matching
            if (text.includes('kaki tiga') || text.includes('tripod')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('kaki tiga')
                );
            }
            
            // Asbes matching - exact condition specification
            if (text.includes('asbes') || text.includes('wire gauze')) {
                const condition = regexMatch[1];
                if (condition) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('asbes') && 
                        item.keterangan.toLowerCase().includes(condition)
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('asbes')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Kasa matching
            if (text.includes('kasa') || text.includes('gauze')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('kasa')
                );
            }
            
            // Alu + Mortar matching - exact size specification
            if (text.includes('alu') || text.includes('mortar') || text.includes('lumpang')) {
                const size = regexMatch[1];
                if (size) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('alu + mortar') && 
                        item.keterangan.toLowerCase().includes(size)
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('alu + mortar')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Neraca matching - exact type specification
            if (text.includes('neraca') || text.includes('balance') || text.includes('timbangan')) {
                const type = regexMatch[1];
                if (type) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('neraca') && 
                        item.nama.toLowerCase().includes(type)
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('neraca')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // pH Meter matching
            if (text.includes('ph meter') || text.includes('ph tester')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('ph meter')
                );
            }
            
            // Sikat Tabung Reaksi matching
            if (text.includes('sikat tabung reaksi') || text.includes('test tube brush')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('sikat tabung reaksi')
                );
            }
            
            // Statif matching - exact type specification
            if (text.includes('statif') || text.includes('stand')) {
                const type = regexMatch[1];
                if (type === 'a' || type === 'bentuk a') {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('statif') && 
                        item.nama.toLowerCase().includes('bentuk a')
                    );
                } else if (type === 'batang') {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('batang statif')
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('statif')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Klem matching - exact type specification
            if (text.includes('klem') || text.includes('clamp')) {
                const type = regexMatch[1];
                if (type === 'universal') {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('klem universal')
                    );
                } else if (type === 'boss head') {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('klem boss head')
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('klem')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Penjepit Tabung Reaksi matching
            if (text.includes('penjepit tabung reaksi') || text.includes('test tube holder')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('penjepit tabung reaksi')
                );
            }
            
            // Rak Tabung Reaksi matching
            if (text.includes('rak tabung reaksi') || text.includes('test tube rack')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('rak tabung reaksi')
                );
            }
            
            // === MODEL DAN ALAT PERAGA MATCHING ===
            // Model matching - exact type specification
            if (text.includes('model')) {
                const type = regexMatch[1];
                if (type) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('model') && 
                        item.nama.toLowerCase().includes(type)
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('model')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Torso matching - exact gender specification
            if (text.includes('torso')) {
                const gender = regexMatch[1];
                if (gender) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('torso') && 
                        item.nama.toLowerCase().includes(gender)
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('torso')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Bola Dunia matching
            if (text.includes('bola dunia') || text.includes('globe')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('bola dunia')
                );
            }
            
            // Tata Surya matching
            if (text.includes('tata surya') || text.includes('solar system')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('tata surya')
                );
            }
            
            // Carta/Poster matching - exact topic specification
            if (text.includes('carta') || text.includes('poster') || text.includes('chart')) {
                const topic = regexMatch[1];
                if (topic) {
                    return inventoryData.find(item => 
                        (item.nama.toLowerCase().includes('carta') || item.nama.toLowerCase().includes('poster')) && 
                        item.nama.toLowerCase().includes(topic.toLowerCase())
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('carta') || item.nama.toLowerCase().includes('poster')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // Alat Peraga matching - exact system specification
            if (text.includes('alat peraga') || text.includes('teaching aid')) {
                const system = regexMatch[1];
                if (system) {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('alat peraga') && 
                        item.nama.toLowerCase().includes(system.toLowerCase())
                    );
                } else {
                    const matches = inventoryData.filter(item => 
                        item.nama.toLowerCase().includes('alat peraga')
                    );
                    return matches.sort((a, b) => b.jumlah - a.jumlah)[0];
                }
            }
            
            // === ALAT UMUM ===
            // Pipet Tetes matching
            if (text.includes('pipet tetes') || text.includes('pipet') || text.includes('dropper')) {
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('pipet tetes')
                );
            }
            
            // Preparat matching
            if (text.includes('preparat') || text.includes('specimen')) {
                // Preparat tidak ada dalam inventaris, tapi bisa dikaitkan dengan kaca benda
                return inventoryData.find(item => 
                    item.nama.toLowerCase().includes('kaca benda')
                );
            }
            
            // Statif matching - exact type specification
            if (text.includes('statif')) {
                const type = regexMatch[1];
                if (type === 'a' || type === 'bentuk a') {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('statif') && 
                        item.nama.toLowerCase().includes('bentuk a')
                    );
                } else if (type === 'batang') {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('batang statif')
                    );
                } else {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('statif') && 
                        !item.nama.toLowerCase().includes('batang')
                    );
                }
            }
            
            // Klem matching - exact type specification
            if (text.includes('klem')) {
                const type = regexMatch[1];
                if (type === 'universal') {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('klem universal')
                    );
                } else if (type === 'boss head') {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('klem boss head')
                    );
                }
            }
            
            // Spygmomanometer/Tensimeter matching
            if (text.includes('spygmomanometer') || text.includes('tensimeter')) {
                const type = regexMatch[1];
                if (type === 'digital') {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('tensimeter digital')
                    );
                } else {
                    return inventoryData.find(item => 
                        item.nama.toLowerCase().includes('spygmomanometer')
                    );
                }
            }
            
            return null;
        }
        
        // Helper function to extract specification from match
        function extractSpecification(fullMatch, regexMatch) {
            const text = fullMatch.toLowerCase();
            
            if (text.includes('gelas kimia') && regexMatch[1]) {
                return `${regexMatch[1]} ml`;
            }
            if (text.includes('silinder ukur') && regexMatch[1]) {
                return `${regexMatch[1]} ml`;
            }
            if (text.includes('labu erlenmeyer') && regexMatch[1]) {
                return `${regexMatch[1]} ml`;
            }
            if (text.includes('corong') && regexMatch[1]) {
                return regexMatch[2] ? `Ã˜ ${regexMatch[1]}-${regexMatch[2]} mm` : `Ã˜ ${regexMatch[1]} mm`;
            }
            if (text.includes('beban') && regexMatch[1]) {
                return `${regexMatch[1]} gr`;
            }
            if (text.includes('panci bedah') && regexMatch[1] && regexMatch[2]) {
                return `${regexMatch[1]} x ${regexMatch[2]} cm`;
            }
            if (text.includes('mikroskop') && regexMatch[1]) {
                return regexMatch[2] ? `${regexMatch[1]} ${regexMatch[2]}` : regexMatch[1];
            }
            if (text.includes('termometer') && regexMatch[1]) {
                return regexMatch[1];
            }
            if ((text.includes('bunsen') || text.includes('pembakar')) && regexMatch[1]) {
                return regexMatch[1];
            }
            if (text.includes('tabung reaksi') && regexMatch[1]) {
                return regexMatch[1];
            }
            if (text.includes('plat tetes') && regexMatch[1]) {
                return regexMatch[1];
            }
            if (text.includes('stetoscope') && regexMatch[1]) {
                return `tipe ${regexMatch[1]}`;
            }
            if (text.includes('katrol') && regexMatch[1]) {
                return `${regexMatch[1]} roda`;
            }
            
            return 'spesifik';
        }
        
        function analyzeEquipmentReplacement(actionText) {
            const replacements = [];
            const text = actionText.toLowerCase();
            
            // Replacement indicators
            const replacementWords = ['ganti', 'diganti', 'mengganti', 'penggantian', 'diperbaiki', 'perbaikan', 'beli baru', 'tambah', 'baru', 'restok', 'restock', 'isi ulang', 'belanja', 'beli', 'order', 'pesan'];
            
            // Use the same comprehensive equipment patterns as damage analysis
            const specificEquipmentPatterns = [
                // Gelas Kimia dengan ukuran spesifik (100ml, 250ml, 300ml, 500ml, 600ml)
                /(?:gelas kimia|beaker)\s*(?:ukuran\s*)?(\d+)\s*ml/gi,
                /(\d+)\s*ml\s*(?:gelas kimia|beaker)/gi,
                
                // Silinder Ukur dengan ukuran spesifik (25ml, 50ml, 250ml)
                /(?:silinder ukur|gelas ukur|measuring cylinder)\s*(?:ukuran\s*)?(\d+)\s*ml/gi,
                /(\d+)\s*ml\s*(?:silinder ukur|gelas ukur|measuring cylinder)/gi,
                
                // Labu Erlenmeyer dengan ukuran spesifik (200ml, 500ml, 1000ml)
                /(?:labu erlenmeyer|erlenmeyer|flask)\s*(?:ukuran\s*)?(\d+)\s*ml/gi,
                /(\d+)\s*ml\s*(?:labu erlenmeyer|erlenmeyer|flask)/gi,
                
                // Corong dengan diameter spesifik (Ã˜ 16-50 mm, Ã˜ 16-75 mm)
                /corong\s*(?:kaca\s*)?(?:diameter\s*|Ã¸\s*)?(\d+)(?:-(\d+))?\s*mm/gi,
                /(?:diameter\s*|Ã¸\s*)?(\d+)(?:-(\d+))?\s*mm\s*corong/gi,
                /corong\s*(?:kaca|plastik)/gi,
                
                // Beban dengan berat spesifik (10gr, 20gr, 30gr, 50gr, 100gr)
                /beban\s*(?:berkait|bercelah)?\s*(\d+)\s*(?:gr|gram)/gi,
                /(\d+)\s*(?:gr|gram)\s*beban/gi,
                
                // Panci Bedah dengan ukuran spesifik (20x20cm, 26x30cm)
                /panci bedah\s*(?:ukuran\s*)?(\d+)\s*x\s*(\d+)\s*cm/gi,
                /(\d+)\s*x\s*(\d+)\s*cm\s*panci bedah/gi,
                
                // Mikroskop dengan tipe spesifik (monokuler, binokuler, stereo, listrik)
                /mikroskop\s*(monokuler|binokuler|stereo)(?:\s*(listrik|manual|u\/lnjt))?/gi,
                /(monokuler|binokuler|stereo)\s*mikroskop/gi,
                /mikroskop\s*(listrik)/gi,
                
                // Termometer dengan tipe spesifik (klinis, raksa, alkohol, dinding)
                /termometer\s*(klinis|raksa|alkohol|dinding)/gi,
                /(klinis|raksa|alkohol|dinding)\s*termometer/gi,
                
                // Bunsen dengan ukuran spesifik (besar, kecil)
                /(?:bunsen|pembakar)\s*(besar|kecil)/gi,
                /(besar|kecil)\s*(?:bunsen|pembakar)/gi,
                
                // Tabung Reaksi dengan ukuran spesifik (besar, sedang, kecil)
                /tabung reaksi\s*(besar|sedang|kecil)/gi,
                /(besar|sedang|kecil)\s*tabung reaksi/gi,
                
                // Plat Tetes dengan ukuran spesifik (besar, kecil)
                /plat tetes\s*(besar|kecil)/gi,
                /(besar|kecil)\s*plat tetes/gi,
                
                // Alat Bedah dengan tipe spesifik (set, box kulit, box kayu)
                /alat bedah\s*(?:set\s*)?(box\s*(?:kulit|kayu))?/gi,
                /(box\s*(?:kulit|kayu))\s*alat bedah/gi,
                /alat bedah\s*set/gi,
                
                // Stetoscope dengan tipe spesifik (tipe 1, 2, 3)
                /stetoscope\s*(?:tipe\s*)?(\d+)/gi,
                /tipe\s*(\d+)\s*stetoscope/gi,
                
                // Aquarium dengan tipe spesifik (besar/kecil, kaca persegi/bulat)
                /aquarium\s*(besar|kecil)?\s*(kaca\s*(?:persegi|bulat))?/gi,
                /(besar|kecil)?\s*(kaca\s*(?:persegi|bulat))?\s*aquarium/gi,
                
                // Lensa dengan tipe spesifik (bikonveks, bikonkaf, tebal/sedang)
                /lensa\s*(bikonveks|bikonkaf)(?:\s*(tebal|sedang))?/gi,
                /(bikonveks|bikonkaf)\s*lensa/gi,
                
                // Stopwatch dengan tipe spesifik (air, biasa)
                /stopwatch\s*(air|biasa)/gi,
                /(air|biasa)\s*stopwatch/gi,
                
                // Neraca dengan tipe spesifik (311, O-Haouse)
                /neraca\s*(311|o-haouse)/gi,
                /(311|o-haouse)\s*neraca/gi,
                
                // Katrol dengan tipe spesifik (1 roda, 2 roda)
                /katrol\s*(\d+)\s*roda/gi,
                /(\d+)\s*roda\s*katrol/gi,
                
                // Asbes dengan kondisi spesifik (baik, kurang baik)
                /asbes\s*(?:kondisi\s*)?(baik|kurang)/gi,
                /(baik|kurang)\s*asbes/gi,
                
                // Botol Labu Didih dengan ukuran (besar, kecil)
                /botol labu didih\s*(besar|kecil)/gi,
                /(besar|kecil)\s*botol labu didih/gi,
                
                // Alu + Mortar dengan ukuran (besar, kecil)
                /(?:alu|mortar)\s*(?:\+\s*mortar|\+\s*alu)?\s*(besar|kecil)/gi,
                /(besar|kecil)\s*(?:alu|mortar)/gi,
                
                // Basicmeter dengan kondisi
                /basicmeter/gi,
                
                // Pompa dengan tipe (pascal, isap, tekan)
                /pompa\s*(pascal|isap|tekan)/gi,
                /(pascal|isap|tekan)\s*pompa/gi,
                
                // Manometer dengan tipe
                /manometer\s*(terbuka)/gi,
                /(terbuka)\s*manometer/gi,
                
                // Kit dengan tipe spesifik
                /kit\s*(elektrostatik|listrik|magnet|mekanika|hidrostatika|panas|optik)/gi,
                /(elektrostatik|listrik|magnet|mekanika|hidrostatika|panas|optik)\s*kit/gi,
                
                // Cermin dengan tipe (datar, datar lipat)
                /cermin\s*(datar)(?:\s*(lipat))?/gi,
                /(datar)(?:\s*(lipat))?\s*cermin/gi,
                
                // Magnet dengan tipe (batang, U)
                /magnet\s*(batang|u)/gi,
                /(batang|u)\s*magnet/gi,
                
                // Garpu Tala
                /garpu tala/gi,
                
                // Slinki dengan tipe
                /slinki(?:\s*(cadangan))?/gi,
                
                // Respirometer
                /respirometer/gi,
                
                // Kotak Genetika dengan tipe (2 warna box kayu, 2 warna box plastik, 5 warna box plastik)
                /kotak genetika\s*(?:(\d+)\s*warna)?\s*(box\s*(?:kayu|plastik))?/gi,
                /(\d+)\s*warna\s*box\s*(kayu|plastik)\s*kotak genetika/gi,
                
                // Model dengan tipe spesifik (otak, mata, telinga, jantung, kulit, ginjal, rangka, molekul)
                /model\s*(otak|mata|telinga|jantung|kulit|ginjal|rangka|molekul)/gi,
                /(otak|mata|telinga|jantung|kulit|ginjal|rangka|molekul)\s*model/gi,
                
                // Torso dengan tipe (wanita, pria)
                /torso\s*(wanita|pria)/gi,
                /(wanita|pria)\s*torso/gi,
                
                // Carta/Poster dengan tipe spesifik
                /(?:carta|poster)\s*([a-zA-Z\s]+)/gi,
                
                // Alat Peraga dengan tipe spesifik
                /alat peraga\s*([a-zA-Z\s]+)/gi,
                
                // Perangkat Perawatan Mikro
                /perangkat perawatan mikro/gi,
                
                // Kaca Benda dan Kaca Penutup
                /kaca\s*(benda|penutup)/gi,
                /(benda|penutup)\s*kaca/gi,
                
                // Lup
                /lup/gi,
                
                // Papan Bedah
                /papan bedah/gi,
                
                // Spygmomanometer dan Tensimeter
                /(?:spygmomanometer|tensimeter)\s*(digital)?/gi,
                /(digital)\s*(?:spygmomanometer|tensimeter)/gi,
                
                // Auksanometer
                /auksanometer/gi,
                
                // Kuadrat
                /kuadrat/gi,
                
                // Insektarium
                /insektarium/gi,
                
                // Kartu Nutrisi
                /kartu nutrisi/gi,
                
                // Bejana dengan tipe (berhubungan, kapiler)
                /bejana\s*(berhubungan|kapiler)/gi,
                /(berhubungan|kapiler)\s*bejana/gi,
                
                // Alat Hukum Boyle
                /alat hukum boyle/gi,
                
                // Pipa dengan tipe (Y, kaca)
                /pipa\s*(y|kaca)/gi,
                /(y|kaca)\s*pipa/gi,
                
                // Ohmeter, Amperemeter, Multitester
                /(?:ohmeter|amperemeter|multitester)/gi,
                
                // Shunt
                /shunt/gi,
                
                // Catu Daya/Power Supply
                /(?:catu daya|power supply)/gi,
                
                // Kotak Baterai
                /kotak baterai/gi,
                
                // Batang Pengaduk
                /batang pengaduk/gi,
                
                // Cawan Petri
                /cawan petri/gi,
                
                // Kaki Tiga
                /kaki tiga/gi,
                
                // Kasa
                /kasa/gi,
                
                // Sikat Tabung Reaksi
                /sikat tabung reaksi/gi,
                
                // Statif dengan tipe (bentuk A, batang)
                /statif\s*(?:bentuk\s*)?(a|batang)?/gi,
                /(bentuk\s*a|batang)\s*statif/gi,
                
                // Klem dengan tipe (universal, boss head)
                /klem\s*(universal|boss head)/gi,
                /(universal|boss head)\s*klem/gi,
                
                // Penjepit Tabung Reaksi
                /penjepit tabung reaksi/gi,
                
                // Rak Tabung Reaksi
                /rak tabung reaksi/gi,
                
                // Keranjang Serangga
                /keranjang serangga/gi,
                
                // Insectnet
                /insectnet/gi,
                
                // pH Meter
                /ph meter/gi,
                
                // Teleskop
                /teleskop/gi,
                
                // Jangka Sorong
                /jangka sorong/gi,
                
                // Perkakas Elektronika
                /perkakas elektronika/gi,
                
                // Mikrometer
                /mikrometer/gi,
                
                // Pipet Tetes
                /pipet tetes/gi,
                /pipet/gi,
                
                // Bola Dunia
                /bola dunia/gi,
                /globe/gi,
                
                // Tata Surya
                /tata surya/gi,
                
                // Preparat
                /preparat/gi
            ];
            
            // Check for specific equipment replacement with specifications
            specificEquipmentPatterns.forEach(pattern => {
                const matches = [...text.matchAll(pattern)];
                matches.forEach(match => {
                    const fullMatch = match[0];
                    const hasReplacement = replacementWords.some(word => 
                        text.includes(word) && 
                        Math.abs(text.indexOf(word) - text.indexOf(fullMatch)) < 50
                    );
                    
                    if (hasReplacement) {
                        // Extract quantity from nearby text
                        const beforeText = text.substring(Math.max(0, text.indexOf(fullMatch) - 30), text.indexOf(fullMatch));
                        const afterText = text.substring(text.indexOf(fullMatch) + fullMatch.length, text.indexOf(fullMatch) + fullMatch.length + 30);
                        const contextText = beforeText + fullMatch + afterText;
                        
                        const quantityMatch = contextText.match(/(\d+)\s*(?:buah|unit|set|pack|pasang)?/);
                        const quantity = quantityMatch ? parseInt(quantityMatch[1]) : 1;
                        
                        // Find exact matching inventory item based on specifications
                        const exactMatch = findExactInventoryMatch(fullMatch, match);
                        
                        if (exactMatch) {
                            replacements.push({
                                keyword: fullMatch,
                                inventoryName: exactMatch.nama,
                                inventoryItem: exactMatch,
                                quantity: quantity,
                                specification: extractSpecification(fullMatch, match)
                            });
                        }
                    }
                });
            });
            
            // Fallback: Check for general equipment mentions without specifications
            const generalEquipmentKeywords = [
                'mikroskop', 'gelas kimia', 'tabung reaksi', 'pipet tetes', 'corong', 'labu erlenmeyer',
                'silinder ukur', 'bunsen', 'termometer', 'beban', 'katrol', 'lensa', 'cermin',
                'magnet', 'stopwatch', 'neraca', 'panci bedah', 'alat bedah', 'stetoscope',
                'aquarium', 'plat tetes', 'batang pengaduk', 'cawan petri', 'kaca benda',
                'kaca penutup', 'asbes', 'kasa', 'statif', 'klem', 'model', 'carta', 'poster'
            ];
            
            generalEquipmentKeywords.forEach(keyword => {
                if (text.includes(keyword)) {
                    const hasReplacement = replacementWords.some(word => 
                        text.includes(word) && 
                        Math.abs(text.indexOf(word) - text.indexOf(keyword)) < 50
                    );
                    
                    if (hasReplacement) {
                        // Extract quantity
                        const keywordIndex = text.indexOf(keyword);
                        const beforeText = text.substring(Math.max(0, keywordIndex - 30), keywordIndex);
                        const afterText = text.substring(keywordIndex + keyword.length, keywordIndex + keyword.length + 30);
                        const contextText = beforeText + keyword + afterText;
                        
                        const quantityMatch = contextText.match(/(\d+)\s*(?:buah|unit|set|pack|pasang)?/);
                        const quantity = quantityMatch ? parseInt(quantityMatch[1]) : 1;
                        
                        // Find best matching inventory item (prefer items with lower quantity for replacement)
                        const matchingItems = inventoryData.filter(item => 
                            item.nama.toLowerCase().includes(keyword)
                        );
                        
                        if (matchingItems.length > 0) {
                            // Sort by quantity (ascending) to prefer items that need restocking
                            const bestMatch = matchingItems.sort((a, b) => a.jumlah - b.jumlah)[0];
                            
                            // Check if this replacement hasn't been recorded yet
                            const alreadyRecorded = replacements.some(r => r.inventoryName === bestMatch.nama);
                            if (!alreadyRecorded) {
                                replacements.push({
                                    keyword: keyword,
                                    inventoryName: bestMatch.nama,
                                    inventoryItem: bestMatch,
                                    quantity: quantity,
                                    specification: 'general'
                                });
                            }
                        }
                    }
                }
            });
            
            return replacements;
        }
        
        function updateInventoryFromIncident(incidentData) {
            let inventoryUpdated = false;
            const reportId = incidentData.id.slice(-4);
            const processedItems = new Set(); // Track processed items to avoid duplicates
            
            // Process equipment damage (ALWAYS reduce inventory when damage is detected)
            if (incidentData.equipmentDamage && incidentData.equipmentDamage.length > 0) {
                incidentData.equipmentDamage.forEach(damage => {
                    // Use the exact inventory item that was found during damage analysis
                    let targetItem = null;
                    
                    if (damage.inventoryItem) {
                        // Use the exact item that was matched during analysis
                        targetItem = damage.inventoryItem;
                    } else {
                        // Fallback: Find exact match by name
                        targetItem = inventoryData.find(item => 
                            item.nama.toLowerCase() === damage.inventoryName.toLowerCase()
                        );
                    }
                    
                    if (targetItem && targetItem.jumlah >= damage.quantity) {
                        const itemKey = `${targetItem.nama}_${damage.specification || 'spesifik'}`;
                        
                        // Check if this item has already been processed in this report
                        if (processedItems.has(itemKey)) {
                            console.log(`Skipping duplicate damage entry for ${targetItem.nama} (${damage.specification || 'spesifik'})`);
                            return;
                        }
                        
                        processedItems.add(itemKey);
                        
                        const originalQuantity = targetItem.jumlah;
                        targetItem.jumlah -= damage.quantity;
                        
                        // Update condition based on remaining quantity
                        if (targetItem.jumlah === 0) {
                            targetItem.kondisi = 'rusak';
                            // Check if this report ID already exists in keterangan to avoid duplicates
                            if (!targetItem.keterangan.includes(`Laporan #${reportId}`)) {
                                targetItem.keterangan += ` [HABIS - ${damage.quantity} unit rusak (${damage.specification || 'spesifik'}), Laporan #${reportId}]`;
                            }
                        } else if (targetItem.kondisi === 'baik' && targetItem.jumlah <= 2) {
                            targetItem.kondisi = 'kurang';
                            // Check if this report ID already exists in keterangan to avoid duplicates
                            if (!targetItem.keterangan.includes(`Laporan #${reportId}`)) {
                                targetItem.keterangan += ` [Berkurang ${damage.quantity} unit karena kerusakan (${damage.specification || 'spesifik'}), Laporan #${reportId}]`;
                            }
                        } else {
                            // Check if this report ID already exists in keterangan to avoid duplicates
                            if (!targetItem.keterangan.includes(`Laporan #${reportId}`)) {
                                targetItem.keterangan += ` [Berkurang ${damage.quantity} unit karena kerusakan (${damage.specification || 'spesifik'}), Laporan #${reportId}]`;
                            }
                        }
                        
                        inventoryUpdated = true;
                        console.log(`Inventory updated: ${targetItem.nama} (${damage.specification || 'spesifik'}) reduced by ${damage.quantity} (${originalQuantity} â†’ ${targetItem.jumlah})`);
                    } else if (targetItem) {
                        console.log(`Warning: Not enough ${targetItem.nama} (${damage.specification || 'spesifik'}) in inventory (requested: ${damage.quantity}, available: ${targetItem.jumlah})`);
                    } else {
                        console.log(`Warning: Could not find inventory item for ${damage.inventoryName} (${damage.specification || 'spesifik'})`);
                    }
                });
            }
            
            // Process equipment replacement (ONLY increase inventory if replacement actually occurred)
            if (incidentData.equipmentReplacement && incidentData.equipmentReplacement.length > 0) {
                incidentData.equipmentReplacement.forEach(replacement => {
                    // Use the exact inventory item that was found during replacement analysis
                    let targetItem = null;
                    
                    if (replacement.inventoryItem) {
                        // Use the exact item that was matched during analysis
                        targetItem = replacement.inventoryItem;
                    } else {
                        // Fallback: Find exact match by name
                        targetItem = inventoryData.find(item => 
                            item.nama.toLowerCase() === replacement.inventoryName.toLowerCase()
                        );
                    }
                    
                    if (targetItem) {
                        const itemKey = `${targetItem.nama}_${replacement.specification || 'spesifik'}_replacement`;
                        
                        // Check if this replacement has already been processed in this report
                        if (processedItems.has(itemKey)) {
                            console.log(`Skipping duplicate replacement entry for ${targetItem.nama} (${replacement.specification || 'spesifik'})`);
                            return;
                        }
                        
                        processedItems.add(itemKey);
                        
                        const originalQuantity = targetItem.jumlah;
                        targetItem.jumlah += replacement.quantity;
                        
                        // Improve condition if replacement occurred
                        if (targetItem.kondisi === 'rusak' && targetItem.jumlah > 0) {
                            targetItem.kondisi = 'kurang';
                            // Check if this report ID already exists in keterangan to avoid duplicates
                            if (!targetItem.keterangan.includes(`Laporan #${reportId}`)) {
                                targetItem.keterangan += ` [Diganti ${replacement.quantity} unit (${replacement.specification || 'spesifik'}), kondisi membaik, Laporan #${reportId}]`;
                            }
                        } else if (targetItem.kondisi === 'kurang' && targetItem.jumlah > 5) {
                            targetItem.kondisi = 'baik';
                            // Check if this report ID already exists in keterangan to avoid duplicates
                            if (!targetItem.keterangan.includes(`Laporan #${reportId}`)) {
                                targetItem.keterangan += ` [Diganti ${replacement.quantity} unit (${replacement.specification || 'spesifik'}), kondisi baik, Laporan #${reportId}]`;
                            }
                        } else {
                            // Check if this report ID already exists in keterangan to avoid duplicates
                            if (!targetItem.keterangan.includes(`Laporan #${reportId}`)) {
                                targetItem.keterangan += ` [Ditambah ${replacement.quantity} unit pengganti (${replacement.specification || 'spesifik'}), Laporan #${reportId}]`;
                            }
                        }
                        
                        inventoryUpdated = true;
                        console.log(`Inventory updated: ${targetItem.nama} (${replacement.specification || 'spesifik'}) increased by ${replacement.quantity} (${originalQuantity} â†’ ${targetItem.jumlah})`);
                    } else {
                        console.log(`Warning: Could not find inventory item for replacement ${replacement.inventoryName} (${replacement.specification || 'spesifik'})`);
                    }
                });
            }
            
            // Update inventory display if changes were made
            if (inventoryUpdated) {
                displayInventoryData();
                
                let message = `Inventaris berhasil diperbarui berdasarkan laporan insiden #${reportId}.`;
                if (incidentData.equipmentDamage && incidentData.equipmentDamage.length > 0) {
                    message += ` ${incidentData.equipmentDamage.length} alat berkurang dari stok karena kerusakan.`;
                }
                if (incidentData.equipmentReplacement && incidentData.equipmentReplacement.length > 0) {
                    message += ` ${incidentData.equipmentReplacement.length} alat pengganti ditambahkan ke stok.`;
                }
                
                showMessage(message, 'success');
            } else if (incidentData.equipmentDamage && incidentData.equipmentDamage.length > 0) {
                // Even if no replacement, still show damage impact
                showMessage(`Laporan insiden #${reportId} berhasil dicatat. Kerusakan alat telah mengurangi stok inventaris.`, 'warning');
            }
        }

        function displayIncidentHistory() {
            const historyContainer = document.getElementById('incidentHistory');
            const noIncidentsMsg = document.getElementById('noIncidents');
            
            if (incidentReports.length === 0) {
                historyContainer.innerHTML = '';
                noIncidentsMsg.classList.remove('hidden');
                return;
            }
            
            noIncidentsMsg.classList.add('hidden');
            
            // Sort reports by timestamp (newest first)
            const sortedReports = [...incidentReports].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            historyContainer.innerHTML = sortedReports.map(report => {
                const reportDate = new Date(report.timestamp);
                const formattedDate = reportDate.toLocaleDateString('id-ID', {
                    weekday: 'short',
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
                const formattedTime = reportDate.toLocaleTimeString('id-ID', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const incidentDateTime = `${report.incidentDate} ${report.incidentTime}`;
                const incidentFormatted = new Date(incidentDateTime).toLocaleDateString('id-ID', {
                    weekday: 'short',
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                }) + ' ' + report.incidentTime;
                
                // Generate inventory impact display
                let inventoryImpactHtml = '';
                if (report.equipmentDamage && report.equipmentDamage.length > 0) {
                    inventoryImpactHtml += `
                        <div class="mt-2 p-2 bg-orange-50 border border-orange-200 rounded">
                            <span class="font-medium text-orange-800 block mb-1 text-xs">âš ï¸ Dampak Inventaris:</span>
                            <div class="space-y-1">
                    `;
                    
                    report.equipmentDamage.forEach(damage => {
                        inventoryImpactHtml += `
                            <div class="text-xs text-orange-700">
                                â€¢ ${damage.inventoryName}: -${damage.quantity} unit (rusak)
                            </div>
                        `;
                    });
                    
                    inventoryImpactHtml += `</div></div>`;
                }
                
                if (report.equipmentReplacement && report.equipmentReplacement.length > 0) {
                    inventoryImpactHtml += `
                        <div class="mt-2 p-2 bg-green-50 border border-green-200 rounded">
                            <span class="font-medium text-green-800 block mb-1 text-xs">ðŸ”„ Penggantian Alat:</span>
                            <div class="space-y-1">
                    `;
                    
                    report.equipmentReplacement.forEach(replacement => {
                        inventoryImpactHtml += `
                            <div class="text-xs text-green-700">
                                â€¢ ${replacement.inventoryName}: +${replacement.quantity} unit (diganti)
                            </div>
                        `;
                    });
                    
                    inventoryImpactHtml += `</div></div>`;
                }

                return `
                    <div class="bg-red-50 border border-red-200 rounded-lg p-3 hover:shadow-md transition-shadow">
                        <div class="flex items-start justify-between mb-2">
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                                <span class="font-semibold text-red-800 text-xs">Laporan #${report.id.slice(-4)}</span>
                                ${(report.equipmentDamage && report.equipmentDamage.length > 0) || (report.equipmentReplacement && report.equipmentReplacement.length > 0) ? 
                                    '<span class="bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full text-xs font-medium ml-2">ðŸ“¦ Inventaris Terpengaruh</span>' : ''}
                            </div>
                            <span class="text-xs text-red-600 bg-red-100 px-2 py-1 rounded">
                                ${formattedDate} ${formattedTime}
                            </span>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-2 mb-2 text-xs">
                            <div>
                                <span class="font-medium text-gray-700">Guru:</span>
                                <span class="text-gray-900 ml-1">${report.teacher}</span>
                            </div>
                            <div>
                                <span class="font-medium text-gray-700">Kelas:</span>
                                <span class="text-gray-900 ml-1">${report.class}</span>
                            </div>
                            <div class="col-span-2">
                                <span class="font-medium text-gray-700">Waktu Kejadian:</span>
                                <span class="text-gray-900 ml-1">${incidentFormatted}</span>
                            </div>
                        </div>
                        
                        <div class="space-y-2">
                            <div>
                                <span class="font-medium text-gray-700 block mb-1 text-xs">ðŸ“ Laporan:</span>
                                <p class="text-gray-900 text-xs bg-white p-2 rounded border">${report.report}</p>
                            </div>
                            
                            <div>
                                <span class="font-medium text-gray-700 block mb-1 text-xs">âœ… Tindakan:</span>
                                <p class="text-gray-900 text-xs bg-white p-2 rounded border">${report.actionTaken}</p>
                            </div>
                        </div>
                        
                        ${inventoryImpactHtml}
                        
                        <div class="mt-2 pt-2 border-t border-red-200 text-xs text-red-600">
                            <span class="font-medium">Pelapor:</span> ${report.reportedBy}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Update statistics every 10 minutes
        function updateStatistics() {
            const visits = document.getElementById('totalVisits');
            const sessions = document.getElementById('bookedSessions');
            
            if (visits && sessions) {
                // Simulate real-time updates
                const currentVisits = parseInt(visits.textContent);
                const currentSessions = parseInt(sessions.textContent);
                
                visits.textContent = currentVisits + Math.floor(Math.random() * 5);
                sessions.textContent = bookings.length;
            }
        }

        // Generate sample incident reports for demonstration
        function generateSampleIncidentReports() {
            const sampleReports = [
                {
                    id: 'incident_' + Date.now() + '_001',
                    timestamp: new Date(Date.now() - 86400000 * 3).toISOString(), // 3 days ago
                    teacher: 'Siti Anidah P., S.Pd (3)',
                    class: 'VII A',
                    incidentDate: new Date(Date.now() - 86400000 * 3).toISOString().split('T')[0],
                    incidentTime: '08:30',
                    report: 'Terdapat 2 buah gelas kimia 250ml yang pecah saat praktikum larutan asam basa. Pecahan kaca berserakan di meja praktikum.',
                    actionTaken: 'Membersihkan pecahan kaca dengan hati-hati, mengganti 2 gelas kimia 250ml yang pecah dengan yang baru dari gudang, dan memberikan instruksi keselamatan tambahan kepada siswa.',
                    reportedBy: 'Admin System',
                    reportedByEmail: 'admin@smpn26sby.sch.id',
                    equipmentDamage: [
                        {
                            keyword: 'gelas kimia 250ml',
                            inventoryName: 'Gelas Kimia',
                            quantity: 2,
                            specification: '250 ml'
                        }
                    ],
                    equipmentReplacement: [
                        {
                            keyword: 'gelas kimia 250ml',
                            inventoryName: 'Gelas Kimia',
                            quantity: 2,
                            specification: '250 ml'
                        }
                    ]
                },
                {
                    id: 'incident_' + Date.now() + '_002',
                    timestamp: new Date(Date.now() - 86400000 * 7).toISOString(), // 1 week ago
                    teacher: 'Nurhayati Ningsih, S.Pd (7)',
                    class: 'VIII B',
                    incidentDate: new Date(Date.now() - 86400000 * 7).toISOString().split('T')[0],
                    incidentTime: '10:15',
                    report: 'Mikroskop monokuler nomor 15 mengalami kerusakan pada lensa objektif. Lensa tampak buram dan tidak dapat difokuskan dengan baik.',
                    actionTaken: 'Memindahkan mikroskop yang rusak ke ruang penyimpanan untuk diperbaiki. Mengganti dengan mikroskop cadangan untuk melanjutkan praktikum pengamatan sel.',
                    reportedBy: 'Admin System',
                    reportedByEmail: 'admin@smpn26sby.sch.id',
                    equipmentDamage: [
                        {
                            keyword: 'mikroskop monokuler',
                            inventoryName: 'Mikroskop',
                            quantity: 1,
                            specification: 'monokuler'
                        }
                    ],
                    equipmentReplacement: []
                },
                {
                    id: 'incident_' + Date.now() + '_003',
                    timestamp: new Date(Date.now() - 86400000 * 14).toISOString(), // 2 weeks ago
                    teacher: 'Suci Alima, S.Si, M.Pd (22)',
                    class: 'IX C',
                    incidentDate: new Date(Date.now() - 86400000 * 14).toISOString().split('T')[0],
                    incidentTime: '13:45',
                    report: '5 buah pipet tetes mengalami keretakan pada bagian ujung. Hal ini terjadi karena terjatuh saat siswa sedang mengambil larutan indikator.',
                    actionTaken: 'Membuang pipet tetes yang retak untuk keselamatan. Mengambil 5 pipet tetes baru dari stok cadangan dan memberikan pelatihan cara penggunaan yang benar kepada siswa.',
                    reportedBy: 'Admin System',
                    reportedByEmail: 'admin@smpn26sby.sch.id',
                    equipmentDamage: [
                        {
                            keyword: 'pipet tetes',
                            inventoryName: 'Pipet Tetes',
                            quantity: 5,
                            specification: 'spesifik'
                        }
                    ],
                    equipmentReplacement: [
                        {
                            keyword: 'pipet tetes',
                            inventoryName: 'Pipet Tetes',
                            quantity: 5,
                            specification: 'spesifik'
                        }
                    ]
                },
                {
                    id: 'incident_' + Date.now() + '_004',
                    timestamp: new Date(Date.now() - 86400000 * 21).toISOString(), // 3 weeks ago
                    teacher: 'Wiwin Andarie, S.Pd, M.Psi (16)',
                    class: 'VII D',
                    incidentDate: new Date(Date.now() - 86400000 * 21).toISOString().split('T')[0],
                    incidentTime: '09:20',
                    report: 'Termometer raksa laboratorium mengalami kerusakan dengan pecahnya tabung kaca. Raksa tumpah di meja praktikum.',
                    actionTaken: 'Segera mengevakuasi siswa dari area tumpahan raksa. Membersihkan tumpahan raksa sesuai prosedur keselamatan. Mengganti dengan termometer digital yang lebih aman.',
                    reportedBy: 'Admin System',
                    reportedByEmail: 'admin@smpn26sby.sch.id',
                    equipmentDamage: [
                        {
                            keyword: 'termometer raksa',
                            inventoryName: 'Termometer Raksa',
                            quantity: 1,
                            specification: 'raksa'
                        }
                    ],
                    equipmentReplacement: [
                        {
                            keyword: 'termometer klinis',
                            inventoryName: 'Termometer Klinis',
                            quantity: 1,
                            specification: 'digital'
                        }
                    ]
                }
            ];
            
            incidentReports.push(...sampleReports);
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Data SDK
            initDataSdk();
            
            // Generate sample data
            generateSampleBookings();
            generateSampleIncidentReports();
            
            // Start real-time clock
            updateRealTimeClock();
            setInterval(updateRealTimeClock, 1000);
            
            // Update statistics periodically
            setInterval(updateStatistics, 600000); // Every 10 minutes
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'992f8871717aab49',t:'MTc2MTIwNDY2Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><!-- Code injected by live-server -->
<script>
	// <![CDATA[  <-- For SVG support
	if ('WebSocket' in window) {
		(function () {
			function refreshCSS() {
				var sheets = [].slice.call(document.getElementsByTagName("link"));
				var head = document.getElementsByTagName("head")[0];
				for (var i = 0; i < sheets.length; ++i) {
					var elem = sheets[i];
					var parent = elem.parentElement || head;
					parent.removeChild(elem);
					var rel = elem.rel;
					if (elem.href && typeof rel != "string" || rel.length == 0 || rel.toLowerCase() == "stylesheet") {
						var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
						elem.href = url + (url.indexOf('?') >= 0 ? '&' : '?') + '_cacheOverride=' + (new Date().valueOf());
					}
					parent.appendChild(elem);
				}
			}
			var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
			var address = protocol + window.location.host + window.location.pathname + '/ws';
			var socket = new WebSocket(address);
			socket.onmessage = function (msg) {
				if (msg.data == 'reload') window.location.reload();
				else if (msg.data == 'refreshcss') refreshCSS();
			};
			if (sessionStorage && !sessionStorage.getItem('IsThisFirstTime_Log_From_LiveServer')) {
				console.log('Live reload enabled.');
				sessionStorage.setItem('IsThisFirstTime_Log_From_LiveServer', true);
			}
		})();
	}
	else {
		console.error('Upgrade your browser. This Browser is NOT supported WebSocket for Live-Reloading.');
	}
	// ]]>
</script>
</body>
</html>
